<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Album Foto Kelas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #111111;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-primary: #ff0000;
            --accent-gradient: linear-gradient(135deg, #ff0000 0%, #a300cc 100%);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --border-radius: 16px;
            --transition-smooth: all 0.4s ease;
            --sidebar-bg: linear-gradient(180deg, rgba(17, 17, 17, 0.7) 0%, rgba(20, 20, 20, 0.5) 100%);
            --sidebar-border: rgba(255, 255, 255, 0.05);
        }

        :root.light-theme {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent-primary: #e74c3c;
            --accent-gradient: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            --glass-bg: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.1);
            --sidebar-bg: linear-gradient(180deg, rgba(255, 255, 255, 0.8) 0%, rgba(245, 245, 245, 0.6) 100%);
            --sidebar-border: rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding-left: 250px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border);
            padding: 1.5rem 1rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: inset 1px 0 1px rgba(255, 255, 255, 0.1), 2px 0 20px rgba(0, 0, 0, 0.3);
        }

        .sidebar-title {
            font-size: 1.4rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
        }

        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1.2rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        /* Submenu styling (indented items under a main menu) */
        .sidebar-submenu .sidebar-nav-link {
            padding-left: 2.2rem;
            font-size: 0.95rem;
            background: transparent;
            color: var(--text-secondary);
        }

        .sidebar-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            transition: left 0.4s ease;
            z-index: -1;
        }

        .sidebar-nav-link:hover {
            color: var(--text-primary);
            transform: translateX(5px);
        }

        .sidebar-nav-link:hover::before {
            left: 0;
        }

        .sidebar-nav-link.active {
            background: var(--accent-gradient);
            color: var(--bg-primary);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
        }

        .sidebar-nav-link i {
            width: 24px;
            text-align: center;
        }

        .sidebar-toggle {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1001;
            background: var(--accent-gradient);
            color: var(--bg-primary);
            border: none;
            padding: 0.9rem 1rem;
            border-radius: var(--border-radius);
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            min-height: 50px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Expanded touch target area */
        .sidebar-toggle::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            cursor: pointer;
            z-index: -1;
        }

        .sidebar-toggle:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.4);
        }

        .sidebar-toggle:hover {
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
            transform: translateY(-2px);
        }

        .sidebar-toggle i {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .sidebar.active ~ .sidebar-toggle i {
            transform: rotate(90deg);
        }

        /* Main Content */
        .main-content {
            padding: 2rem;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .search-box {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 2rem;
            padding: 0.8rem 1.2rem;
            font-size: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            color: var(--text-primary);
            transition: var(--transition-smooth);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.1);
        }

        .search-box:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--accent-primary);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
        }

        #searchWrapper {
            width: 100%;
            display: flex;
            justify-content: center;
            transition: var(--transition-smooth);
        }

        #searchWrapper.search-box-sticky {
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
            background: linear-gradient(180deg, rgba(17, 17, 17, 0.98) 0%, rgba(17, 17, 17, 0.95) 100%);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 30px rgba(255, 0, 0, 0.15);
            animation: slideDown 0.5s ease-out;
            margin: 0;
        }

        #searchWrapper.search-box-sticky .search-box {
            max-width: 550px;
            padding: 0.9rem 1.3rem;
            box-shadow: 0 0 25px rgba(255, 0, 0, 0.2);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .letter-section {
            margin-bottom: 2.5rem;
        }

        .letter-header {
            font-size: 1.8rem;
            margin: 1.5rem 0 1rem;
            color: var(--accent-primary);
            border-bottom: 2px solid var(--glass-border);
            padding-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--accent-primary), #a300cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: fadeInLeft 0.6s ease-out;
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.2rem;
        }

        .gallery-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition-smooth);
            position: relative;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .gallery-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
            z-index: 1;
        }

        .gallery-item:hover::before {
            left: 100%;
        }

        .gallery-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(255, 0, 0, 0.3), 0 0 20px rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.5);
        }

        .gallery-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
            background: #222;
        }

        .gallery-item img.lazy {
            filter: blur(3px);
        }

        .gallery-item img:not(.lazy) {
            filter: blur(0);
        }

        .gallery-item img {
            animation: fadeInImage 0.5s ease-in;
        }

        @keyframes fadeInImage {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .gallery-item-name {
            padding: 0.7rem 0.7rem 0.3rem;
            font-size: 0.95rem;
            color: var(--text-primary);
            text-align: center;
            font-weight: 500;
        }

        .gallery-item-date {
            padding: 0rem 0.7rem 0.7rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
        }
        .sidebar-profile-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-primary);
            margin-bottom: 1rem;
        }
        .sidebar-profile-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .sidebar-profile-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .modal-content {
            max-width: 90%;
            max-height: 80%;
            border-radius: var(--border-radius);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
        }

        .modal-name {
            margin-top: 1rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .download-btn {
            margin-top: 1rem;
            padding: 0.7rem 1.5rem;
            background: var(--accent-gradient);
            color: var(--bg-primary);
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .download-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 0, 0, 0.6);
        }

        .download-btn:hover::after {
            width: 300px;
            height: 300px;
        }

        .download-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .download-btn-loading {
            pointer-events: none;
        }

        .download-btn-text {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .download-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-top-color: var(--bg-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
        }

         /*Developer Content*/
        .developer-content {
            padding: 2rem;
            animation: fadeIn 0.6s ease-out;
        }

        .sidebar-profile {
            max-width: 500px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 0, 0, 0.05) 100%);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .sidebar-profile p {
            line-height: 1.8;
            color: var(--text-secondary);
            margin-top: 1rem;
        }

        /* Settings Menu */
        .settings-menu {
            margin-top: auto;
            padding-top: 1.5rem;
            border-top: 1px solid var(--glass-border);
        }

        .settings-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 1.2rem;
            margin-bottom: 0.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
            cursor: pointer;
        }

        .settings-item:hover {
            background: rgba(255, 0, 0, 0.1);
            border-color: var(--accent-primary);
        }

        .settings-item-label {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .toggle-switch {
            width: 48px;
            height: 28px;
            background: var(--glass-border);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid var(--glass-border);
        }

        .toggle-switch.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .portfolio-link {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem 1.2rem;
            margin-top: 0.5rem;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.1), rgba(163, 0, 204, 0.1));
            border: 1px solid var(--accent-primary);
            border-radius: var(--border-radius);
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition-smooth);
            font-weight: 500;
        }

        .portfolio-link:hover {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.2), rgba(163, 0, 204, 0.2));
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3);
        }

        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            margin-top: 1.5rem;
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #25D366 0%, #1FA850 100%);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            border: none;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.6);
        }

        /* Statistics Footer */
        .stats-footer {
            margin-top: 4rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.05) 0%, rgba(163, 0, 204, 0.05) 100%);
            border-top: 2px solid var(--glass-border);
            border-radius: var(--border-radius);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stats-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            padding: 1rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
        }

        .stat-item:hover {
            background: rgba(255, 0, 0, 0.08);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stats-footer-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding-left: 0;
                padding-top: 50px;
            }

            .sidebar {
                width: 100%;
                height: 100%;
                position: fixed;
                left: -100%;
                transition: 0.4s;
            }

            .sidebar.active {
                left: 0;
            }

            .search-box {
                margin-top: 0;
                width: 90%;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 1rem;
            }

            .gallery-item img {
                height: 140px;
            }

            .settings-item {
                font-size: 0.9rem;
                padding: 0.7rem 1rem;
            }

            .portfolio-link {
                font-size: 0.9rem;
                padding: 0.7rem 1rem;
            }
        }

        /* Desktop - Sembunyikan tombol toggle di layar besar */
        @media (min-width: 769px) {
            .sidebar-toggle {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <button class="sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-title">ALBUM KELAS</div>
        <a href="#" class="sidebar-nav-link active" data-filter="all">
            <i class="fas fa-images"></i> SEMUA FOTO
        </a>
        <!-- Submenu under 'SEMUA FOTO' for group photos (gender: 'all') -->
        <div class="sidebar-submenu">
            <a href="#" class="sidebar-nav-link" data-filter="group">
                <i class="fas fa-users"></i> FOTO BERSAMA
            </a>
        </div>
        <a href="#" class="sidebar-nav-link" data-filter="male">
            <i class="fas fa-mars"></i> FOTO LAKI-LAKI
        </a>
        <a href="#" class="sidebar-nav-link" data-filter="female">
            <i class="fas fa-venus"></i> FOTO PEREMPUAN
        </a>
        <a href="#" class="sidebar-nav-link" data-target="about">
            <i class="fas fa-user"></i> DEVELOPER
        </a>
    </aside>

    <main class="main-content" id="section-all">
        <!-- Bar Pencarian -->
        <div id="searchWrapper">
            <input type="text" id="searchInput" class="search-box" placeholder="Cari nama siswa atau tanggal (DD-MM-YYYY)...">
        </div>

        <!-- Notice: search feature development state -->
        <div id="searchNotice" aria-live="polite" style="text-align: center; margin-top: 0.6rem; margin-bottom: 1.2rem; color: var(--text-secondary); font-size: 0.92rem;">
            Fitur Pencarian Gambar Masih Dalam Tahap Pengembangan, Mungkin Saja Tidak Berfungsi Semestinya
        </div>

        <!-- Pesan jika tidak ditemukan -->
        <div id="noResultsMessage" style="text-align: center; margin: 2rem 0; color: var(--text-secondary); display: none;">
            Maaf yo kawen, non namo "<span id="searchedTerm"></span>" Indo lai. Mungkin Typo titu. Cubo poelok baliek.
        </div>
        
        <!-- Konten galeri -->
        <div id="galleryContainer"></div>

        <!-- Statistics Footer -->
        <div class="stats-footer" id="statsFooter" style="display: none;">
            <div class="stats-content" id="statsContent"></div>
            <div class="stats-footer-text" id="statsText"></div>
        </div>
    </main>

    <main class="developer-content" id="section-about" style="display: none;">
        <!-- Konten Developer -->
        <div class="sidebar-profile">
            <img src="https://i.ibb.co.com/Fqy0Dgdj/4-Nov-14-35-lmc-8-4-1.jpg" alt="Foto Profil Zhyllan Fyllah" class="sidebar-profile-img">
            <div class="sidebar-profile-name">Zhyllan Fyllah</div>
            <div class="sidebar-profile-title">Jurusan TKJ</div>
            <p>Saya adalah seorang siswa SMK N 1 LEMBAH MELINTANG yang berfokus di bidang website developer,saya membuat website ini bermaksud agar teman-teman dapat mengakses kenangan dan album foto kembali,untuk mengingat semua kenangan itu,dan semua fitur website ini saya buat dengan beberapa asset dari halaman portofolio saya yang sebelumnya.</p>
            <p><br>semua fitur di halaman ini,saya buat dengan kesederhanaan,agar teman-teman dapat mengaksesnya dengan mudah.</p>
            <p><br>Bagi teman2 yang ingin menambahkan foto di website ini silahkan hubungi saya dengan cara klik tombol berikut...</p>
            <a href="https://wa.me/6285165721384?text=Kawen%2C%20aku%20ondak%20momintak%20tambahken%20foto%20di%20website%20tu%20bulieh%3F" 
               target="_blank" 
               class="btn-whatsapp"
               style="
                    display: inline-flex;
                    align-items: center;
                    gap: 0.8rem;
                    padding: 0.9rem 2rem;
                    background: #25D366;
                    color: white;
                    font-weight: 600;
                    text-decoration: none;
                    border-radius: 50px;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
               "
               onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 16px rgba(37,211,102,0.4)';"
               onmouseout="this.style.transform='none'; this.style.boxShadow='0 4px 12px rgba(37,211,102,0.3)';"
            >
                <i class="fab fa-whatsapp" style="font-size: 1.2rem;"></i>
                Kirim via WhatsApp
            </a>

            <!-- Settings Menu -->
            <div class="settings-menu">
                <div class="settings-title">⚙️ Pengaturan</div>
                
                <div class="settings-item" onclick="toggleTheme()">
                    <label class="settings-item-label">
                        <i class="fas fa-moon"></i>
                        Tema Gelap
                    </label>
                    <div class="toggle-switch active" id="themeToggle"></div>
                </div>

                <a href="https://jirankun.github.io/portofoliozhyllan/" target="_blank" class="portfolio-link">
                    <i class="fas fa-briefcase"></i>
                    Kunjungi Portofolio
                </a>
            </div>
            <p>Di Buat dengan VSCode dan Copilot Agent Code</p>
        </div>
    </main>

    <!-- Modal Popup -->
    <div class="modal" id="imageModal" onclick="closeModal()">
        <span class="close" onclick="event.stopPropagation(); closeModal()">&times;</span>
        <img class="modal-content" id="modalImage">
        <div class="modal-name" id="modalName"></div>
        <div id="modalDate" style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);"></div>
        <button class="download-btn" id="downloadBtn" onclick="event.stopPropagation(); downloadImage()">
            <span class="download-btn-text"><i class="fas fa-download"></i> Download Gambar</span>
        </button>
    </div>

    <script>
        // === LOAD DATA FOTO DARI FILE DB ===
        let photos = [];

        // Fungsi untuk load data foto dari file JSON
        async function loadPhotosFromDB() {
            try {
                const response = await fetch('./DB/photos.json');
                if (!response.ok) {
                    throw new Error('Gagal membaca file photos.json');
                }
                const data = await response.json();
                photos = data.photos;
                console.log('Data foto berhasil dimuat dari DB/photos.json:', photos);
                
                // Render galeri setelah data dimuat
                renderGallery();
                
                // Restore user preferences setelah halaman sepenuhnya dimuat
                setTimeout(() => {
                    restoreUserState();
                }, 100);
            } catch (error) {
                console.error('Error loading photos:', error);
                alert('Gagal memuat data foto. Pastikan file DB/photos.json tersedia.');
            }
        }

        // === DATA FOTO === (Fallback jika JSON tidak dapat dimuat)
        const fallbackPhotos = [
            { name: "Zhyllan", gender: "male", url: "https://i.ibb.co.com/Fqy0Dgdj/4-Nov-14-35-lmc-8-4-1.jpg" },
        ];

        // === HELPER FUNCTIONS FOR DATE HANDLING ===
        // Helper function to format date from YYYY-MM-DD to DD-MM-YYYY
        function formatDate(dateStr) {
            if (!dateStr) return 'No date';
            const [year, month, day] = dateStr.split('-');
            return `${day}-${month}-${year}`;
        }

        // Helper function to check if date matches search query
        function matchesDateQuery(photoDate, searchQuery) {
            if (!photoDate) return false;
        
            const formatted = formatDate(photoDate);
            const queryDigits = searchQuery.replace(/\D/g, '');
            const dateDigits = formatted.replace(/\D/g, '');
        
            return dateDigits.includes(queryDigits) || formatted.includes(searchQuery);
        }

        // Combined filter function that searches by name and date
        function filterPhotosBySearchQuery(query) {
            if (!query) return photos;
        
            return photos.filter(p => {
                const matchesName = p.name.toLowerCase().includes(query);
                const matchesDate = matchesDateQuery(p.date, query);
                return matchesName || matchesDate;
            });
        }

        // === STATISTICS FUNCTIONS ===
        // Calculate months elapsed from a date to today
        function calculateMonthsAgo(dateStr) {
            if (!dateStr) return null;
            
            const [year, month, day] = dateStr.split('-');
            const photoDate = new Date(year, month - 1, day);
            const today = new Date();
            
            let monthsAgo = (today.getFullYear() - photoDate.getFullYear()) * 12;
            monthsAgo += today.getMonth() - photoDate.getMonth();
            
            return monthsAgo;
        }

        // Format months ago text
        function formatMonthsAgoText(monthsAgo) {
            if (monthsAgo === 0) return 'Bulan ini';
            if (monthsAgo === 1) return '1 bulan lalu';
            if (monthsAgo < 12) return `${monthsAgo} bulan lalu`;
            
            const yearsAgo = Math.floor(monthsAgo / 12);
            const remainingMonths = monthsAgo % 12;
            
            if (remainingMonths === 0) {
                return yearsAgo === 1 ? '1 tahun lalu' : `${yearsAgo} tahun lalu`;
            } else {
                return `${yearsAgo} tahun ${remainingMonths} bulan lalu`;
            }
        }

        // Calculate and display statistics
        function updateStatistics(displayedPhotos) {
            const statsFooter = document.getElementById('statsFooter');
            const statsContent = document.getElementById('statsContent');
            const statsText = document.getElementById('statsText');
            
            if (displayedPhotos.length === 0) {
                statsFooter.style.display = 'none';
                return;
            }

            // Total photos
            const totalPhotos = displayedPhotos.length;
            
            // Get oldest and newest dates
            const dates = displayedPhotos
                .filter(p => p.date)
                .map(p => new Date(p.date))
                .sort((a, b) => a - b);
            
            let statsHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalPhotos}</div>
                    <div class="stat-label">Total Foto</div>
                </div>
            `;
            
            if (dates.length > 0) {
                const newestDate = dates[dates.length - 1];
                const oldestDate = dates[0];
                const monthsOldest = calculateMonthsAgo(oldestDate.toISOString().split('T')[0]);
                const monthsNewest = calculateMonthsAgo(newestDate.toISOString().split('T')[0]);
                
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-number">${monthsNewest}</div>
                        <div class="stat-label">Foto Terbaru</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${monthsOldest}</div>
                        <div class="stat-label">Foto Tertua</div>
                    </div>
                `;
                
                const newestText = formatMonthsAgoText(monthsNewest);
                const oldestText = formatMonthsAgoText(monthsOldest);
                statsText.textContent = `Foto tertua: ${oldestText} | Foto terbaru: ${newestText}`;
            }
            
            statsContent.innerHTML = statsHTML;
            statsFooter.style.display = 'block';
        }

    // === RENDER OTOMATIS A-Z ===
    function renderGallery(filteredPhotos = photos) {
        const container = document.getElementById('galleryContainer');
        const noResultsMsg = document.getElementById('noResultsMessage');
        const searchedTermEl = document.getElementById('searchedTerm');

        // Ambil query pencarian saat ini
        const currentQuery = document.getElementById('searchInput').value.trim();

        if (filteredPhotos.length === 0 && currentQuery !== '') {
            // Tidak ada hasil
            searchedTermEl.textContent = currentQuery;
            noResultsMsg.style.display = 'block';
            container.innerHTML = '';
        } else {
            // Ada hasil → tampilkan galeri
            noResultsMsg.style.display = 'none';
            container.innerHTML = '';

            const groups = {};
            filteredPhotos.forEach(photo => {
                const firstLetter = photo.name.charAt(0).toUpperCase();
                if (!groups[firstLetter]) groups[firstLetter] = [];
                groups[firstLetter].push(photo);
            });

            const sortedLetters = Object.keys(groups).sort();
            sortedLetters.forEach(letter => {
                const section = document.createElement('div');
                section.className = 'letter-section';
                section.innerHTML = `<h2 class="letter-header">${letter}</h2><div class="gallery-grid" id="grid-${letter}"></div>`;
                container.appendChild(section);

                const grid = section.querySelector(`#grid-${letter}`);
                groups[letter].forEach(photo => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.dataset.person = photo.name;
                    item.dataset.gender = photo.gender;
                        item.onclick = () => openModal(photo.url, photo.name, photo.date);
                        const formattedDate = formatDate(photo.date);
                        item.innerHTML = `
                    <img data-src="${photo.url}" alt="${photo.name}" class="lazy">
                    <div class="gallery-item-name">${photo.name}</div>
                        <div class="gallery-item-date">${formattedDate}</div>
                `;
                    grid.appendChild(item);
                });
            });

            initLazyLoading();
            updateStatistics(filteredPhotos);
        }
    }

        // === RESPONSIVE SEARCH WITH DEBOUNCING ===
        let searchTimeout;
        const searchInput = document.getElementById('searchInput');
        
        // Real-time search with debouncing for better performance
        searchInput.addEventListener('input', function(e) {
            const query = this.value.toLowerCase().trim();
            
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            // Save search state immediately
            saveSearchState(query);
            
            // Debounce the actual filtering and rendering (50ms)
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 50);
        });
        
        // Instant clear on Escape key
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
                clearTimeout(searchTimeout);
                saveSearchState('');
                performSearch('');
            }
        });
        
        // Helper function to perform search with current filter applied
        function performSearch(query) {
            const lastFilter = userPreferences.get('lastFilter') || 'all';
            
            console.log('performSearch called with:', { query, lastFilter, totalPhotos: photos.length });
            
            // STEP 1: Start dengan semua foto dari database
            let results = [...photos];
            
            // STEP 2: Apply search query jika ada
            if (query && query.trim().length > 0) {
                results = results.filter(p => {
                    const matchesName = p.name.toLowerCase().includes(query);
                    const matchesDate = matchesDateQuery(p.date, query);
                    return matchesName || matchesDate;
                });
                console.log('After search filter:', results.length);
            }
            
            // STEP 3: Apply gender filter
            // Requirement: photos with gender === 'all' (group photos) should
            // only appear in the 'all' view and in the dedicated 'group' submenu.
            if (lastFilter && lastFilter !== 'all') {
                if (lastFilter === 'group') {
                    // Show only group photos (gender === 'all')
                    results = results.filter(p => p.gender === 'all');
                } else if (lastFilter === 'male' || lastFilter === 'female') {
                    // Show only exact gender matches (exclude group photos)
                    results = results.filter(p => p.gender === lastFilter);
                }
                console.log('After gender filter:', results.length);
            }
            
            console.log('Final results:', results.length);
            renderGallery(results);
        }

        // === FILTER JENIS KELAMIN (Sidebar) ===
        document.querySelectorAll('.sidebar-nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                // Cek apakah link memiliki data-target (untuk section khusus seperti Developer)
                const target = link.dataset.target;
                if (target) {
                    // Simpan menu state
                    saveActiveMenu(target);
                    
                    // Sembunyikan semua section
                    document.getElementById('section-all').style.display = 'none';
                    document.getElementById('section-about').style.display = 'none';
                    // Tampilkan section yang dipilih
                    document.getElementById('section-' + target).style.display = 'block';
                    
                    // Tutup sidebar di HP
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                    return;
                }

                // Untuk filter galeri biasa
                const filter = link.dataset.filter;
                if (filter !== undefined) {
                    // Simpan filter state
                    saveFilterState(filter);
                    saveActiveMenu(filter);
                    
                    // Tampilkan section galeri
                    document.getElementById('section-all').style.display = 'block';
                    document.getElementById('section-about').style.display = 'none';
                    
                    // Get current search query
                    const searchQuery = document.getElementById('searchInput').value.toLowerCase().trim();
                    
                    console.log('Menu clicked - filter:', filter, 'search:', searchQuery);
                    
                    // Perform search with new filter - ini akan menerapkan keduanya
                    performSearch(searchQuery);
                    
                    // Tutup sidebar di HP
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').classList.remove('active');
                    }
                }
            });
        });

        // === LAZY LOADING ===
        function initLazyLoading() {
            if ('IntersectionObserver' in window) {
                const observerOptions = {
                    root: null,
                    rootMargin: '50px',
                    threshold: 0.01
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            const src = img.dataset.src;
                            
                            // Preload gambar
                            const tempImg = new Image();
                            tempImg.onload = function() {
                                img.src = src;
                                img.classList.remove('lazy');
                                observer.unobserve(img);
                            };
                            tempImg.onerror = function() {
                                // Fallback jika gambar gagal dimuat
                                img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIj48cmVjdCBmaWxsPSIjMzMzIiB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIvPjwvc3ZnPg==';
                                img.classList.add('error');
                                observer.unobserve(img);
                            };
                            tempImg.src = src;
                        }
                    });
                }, observerOptions);

                document.querySelectorAll('img.lazy').forEach(img => {
                    // Placeholder blur image
                    img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIj48cmVjdCBmaWxsPSIjMjIyIiB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIvPjwvc3ZnPg==';
                    observer.observe(img);
                });
            } else {
                // Fallback untuk browser lama
                document.querySelectorAll('img.lazy').forEach(img => {
                    img.src = img.dataset.src;
                    img.classList.remove('lazy');
                });
            }
        }

        // === POPUP & DOWNLOAD ===
        function openModal(src, name, date) {
            document.getElementById('modalImage').src = src;
            document.getElementById('modalName').textContent = name;
            document.getElementById('imageModal').style.display = 'flex';
            
                const photo = photos.find(p => p.url === src);
                if (photo && photo.date) {
                    const formattedDate = formatDate(photo.date);
                    document.getElementById('modalDate').textContent = formattedDate;
                } else {
                    document.getElementById('modalDate').textContent = '';
                }
            
            // Reset button state
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('download-btn-loading');
            downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-download"></i> Download Gambar</span>';
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }

        function downloadImage() {
            const src = document.getElementById('modalImage').src;
            const name = document.getElementById('modalName').textContent;
            const downloadBtn = document.getElementById('downloadBtn');

            // Tampilkan loading state
            downloadBtn.disabled = true;
            downloadBtn.classList.add('download-btn-loading');
            downloadBtn.innerHTML = '<span class="download-btn-text"><span class="download-spinner"></span> Sedang Download...</span>';

            // Fetch gambar dengan CORS handling
            fetch(src)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.blob();
                })
                .then(blob => {
                    // Buat URL dari blob
                    const blobUrl = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = blobUrl;
                    
                    // Format nama file
                    const timestamp = new Date().toISOString().split('T')[0];
                    a.download = `${name.replace(/\s+/g, '_')}_${timestamp}.jpg`;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    // Bersihkan blob URL
                    window.URL.revokeObjectURL(blobUrl);

                    // Reset button dan tampilkan success message
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('download-btn-loading');
                    downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-check"></i> Download Berhasil!</span>';
                    
                    // Kembalikan ke state normal setelah 2 detik
                    setTimeout(() => {
                        if (document.getElementById('imageModal').style.display === 'flex') {
                            downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-download"></i> Download Gambar</span>';
                        }
                    }, 2000);
                })
                .catch(error => {
                    console.error('Download error:', error);
                    
                    // Fallback ke metode lama jika fetch gagal
                    try {
                        const a = document.createElement('a');
                        a.href = src;
                        a.download = `${name.replace(/\s+/g, '_')}.jpg`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);

                        downloadBtn.disabled = false;
                        downloadBtn.classList.remove('download-btn-loading');
                        downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-check"></i> Download Berhasil!</span>';
                        
                        setTimeout(() => {
                            if (document.getElementById('imageModal').style.display === 'flex') {
                                downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-download"></i> Download Gambar</span>';
                            }
                        }, 2000);
                    } catch (fallbackError) {
                        downloadBtn.disabled = false;
                        downloadBtn.classList.remove('download-btn-loading');
                        downloadBtn.innerHTML = '<span class="download-btn-text"><i class="fas fa-exclamation-circle"></i> Gagal Download</span>';
                        alert('Gagal mendownload gambar. Silakan coba lagi atau gunakan klik kanan > Simpan gambar.');
                    }
                });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // === MOBILE SIDEBAR ===
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');

        // Click event
        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        // Touch event untuk responsiveness yang lebih baik
        toggleBtn.addEventListener('touchstart', function(e) {
            this.style.opacity = '0.8';
        });
        
        toggleBtn.addEventListener('touchend', function(e) {
            this.style.opacity = '1';
        });

        // Tutup sidebar saat klik di area yang bukan sidebar atau tombol
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768 && sidebar.classList.contains('active')) {
                if (!sidebar.contains(e.target) && e.target.id !== 'sidebarToggle' && !toggleBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            }
        });

        // Tutup sidebar saat swipe
        let touchStartX = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        }, false);

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            if (window.innerWidth <= 768 && sidebar.classList.contains('active')) {
                if (touchEndX - touchStartX > 50) {
                    // Swipe ke kanan > buka
                    sidebar.classList.add('active');
                } else if (touchStartX - touchEndX > 50) {
                    // Swipe ke kiri > tutup
                    sidebar.classList.remove('active');
                }
            }
        }, false);

        // === INISIALISASI ===
        // Load data foto dari file DB/photos.json
        loadPhotosFromDB();

        // === USER PREFERENCES MANAGER ===
        const userPreferences = {
            save: (key, value) => {
                const prefs = JSON.parse(localStorage.getItem('userPreferences') || '{}');
                prefs[key] = value;
                localStorage.setItem('userPreferences', JSON.stringify(prefs));
            },
            get: (key) => {
                const prefs = JSON.parse(localStorage.getItem('userPreferences') || '{}');
                return prefs[key];
            },
            clear: () => {
                localStorage.removeItem('userPreferences');
            }
        };

        // Fungsi untuk menyimpan state filter
        function saveFilterState(filterType) {
            userPreferences.save('lastFilter', filterType);
        }

        // Fungsi untuk menyimpan state search
        function saveSearchState(query) {
            userPreferences.save('lastSearch', query);
        }

        // Fungsi untuk menyimpan menu aktif
        function saveActiveMenu(menuType) {
            userPreferences.save('lastMenu', menuType);
        }

        // Fungsi untuk restore state saat load
        function restoreUserState() {
            const lastMenu = userPreferences.get('lastMenu') || 'all';
            const lastSearch = userPreferences.get('lastSearch') || '';

            console.log('Restoring state:', { lastMenu, lastSearch });

            // STEP 1: Restore search input value
            if (lastSearch) {
                document.getElementById('searchInput').value = lastSearch;
            }

            // STEP 2: Click menu link to restore filter - will trigger performSearch
            const menuLink = document.querySelector(`[data-filter="${lastMenu}"]`);
            if (menuLink) {
                menuLink.click();
            } else {
                // Fallback to 'all' if not found
                const allLink = document.querySelector('[data-filter="all"]');
                if (allLink) allLink.click();
            }
        }

        // THEME TOGGLE ===
        function toggleTheme() {
            const html = document.documentElement;
            const toggle = document.getElementById('themeToggle');
            
            if (html.classList.contains('light-theme')) {
                html.classList.remove('light-theme');
                toggle.classList.remove('active');
                localStorage.setItem('theme', 'dark');
            } else {
                html.classList.add('light-theme');
                toggle.classList.add('active');
                localStorage.setItem('theme', 'light');
            }
        }

        // Load tema dari localStorage saat halaman dimuat
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const html = document.documentElement;
            const toggle = document.getElementById('themeToggle');
            
            if (savedTheme === 'light') {
                html.classList.add('light-theme');
                toggle.classList.add('active');
            } else {
                html.classList.remove('light-theme');
                toggle.classList.remove('active');
            }
        }

        // Load tema saat halaman siap
        loadTheme();

        // === STICKY SEARCH BAR ===
        const searchWrapper = document.getElementById('searchWrapper');
        let lastScrollTop = 0;

        window.addEventListener('scroll', () => {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 100) {
                // Ketika scroll ke bawah lebih dari 100px
                searchWrapper.classList.add('search-box-sticky');
            } else {
                // Ketika scroll kembali ke atas
                searchWrapper.classList.remove('search-box-sticky');
            }
            
            lastScrollTop = scrollTop;
        });
    </script>
</body>

</html>