<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Togetherness TKJ OnE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== ROBOTIC CYBERPUNK VARIABLES ===== */
        :root {
            --sidebar-width: 320px;
            --sidebar-collapsed-width: 80px;
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-panel: #0f0f0f;
            --text-primary: #00ff88;
            --text-secondary: #00cc66;
            --text-accent: #ff0080;
            --text-warning: #ffaa00;
            --accent-primary: #00ffff;
            --accent-secondary: #ff0080;
            --accent-tertiary: #ffaa00;
            --accent-gradient: linear-gradient(135deg, #00ffff 0%, #ff0080 50%, #ffaa00 100%);
            --border-primary: #00ffff;
            --border-secondary: #ff0080;
            --border-tertiary: #ffaa00;
            --glass-bg: rgba(0, 255, 136, 0.08);
            --glass-border: rgba(0, 255, 136, 0.25);
            --border-radius: 16px;
            --border-radius-small: 8px;
            --transition-smooth: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease, box-shadow 0.3s ease;
            --sidebar-bg: linear-gradient(180deg, rgba(10, 10, 10, 0.98) 0%, rgba(15, 15, 15, 0.95) 100%);
            --sidebar-border: rgba(0, 255, 136, 0.3);
            --glow-primary: 0 0 12px rgba(0, 255, 136, 0.5), 0 0 24px rgba(0, 255, 136, 0.3);
            --glow-secondary: 0 0 15px rgba(255, 0, 128, 0.6), 0 0 30px rgba(255, 0, 128, 0.3);
            --glow-tertiary: 0 0 10px rgba(255, 170, 0, 0.4);
            --scan-line: linear-gradient(transparent 50%, rgba(0, 255, 136, 0.03) 50%);
            --grid-pattern: linear-gradient(rgba(0, 255, 136, 0.05) 1px, transparent 1px),
                           linear-gradient(90deg, rgba(0, 255, 136, 0.05) 1px, transparent 1px);
            --shadow-smooth: 0 4px 20px rgba(0, 255, 136, 0.08);
            --shadow-hover: 0 8px 32px rgba(0, 255, 136, 0.15);
            --shadow-strong: 0 12px 48px rgba(0, 255, 136, 0.2);
        }
        /* === LOADING SCREEN === */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #000 0%, #111 50%, #000 100%);
            background-size: 400% 400%;
            animation: bgShift 5s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 9999;
            color: var(--accent-primary);
            text-align: center;
            overflow: hidden;
            box-sizing: border-box;
        }
        @keyframes bgShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .hidden {
            opacity: 0;
        }
        .slide-left {
            transform: translateX(-100%);
        }
        .slide-right {
            transform: translateX(100%);
        }
        .scale-in {
            transform: scale(0);
        }
        .fade-in {
            opacity: 0;
        }
        .fall {
            transform: translateY(-200px);
        }
        .animate-slide-left {
            animation: slideLeft 0.8s ease-out forwards;
        }
        .animate-slide-right {
            animation: slideRight 0.8s ease-out forwards;
        }
        .animate-scale-in {
            animation: scaleIn 0.8s ease-out forwards;
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        .animate-fall {
            animation: fall 0.8s ease-out forwards;
        }
        @keyframes slideLeft {
            0% {
                opacity: 0;
                transform: translateX(-100%);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes slideRight {
            0% {
                opacity: 0;
                transform: translateX(100%);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes scaleIn {
            0% {
                opacity: 0;
                transform: scale(0);
            }
            60% {
                opacity: 1;
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes fall {
            0% {
                opacity: 0;
                transform: translateY(-200px);
            }
            60% {
                opacity: 1;
                transform: translateY(20px);
            }
            100% {
                transform: translateY(0);
            }
        }
        .loader {
            width: 50px;
            aspect-ratio: 1;
            display: none;
            border: 4px solid #0000;
            border-radius: 50%;
            border-color: #ccc #0000;
            animation: l16 1s infinite linear;
        }
        .loader.show {
            display: grid;
        }
        .loader::before,
        .loader::after {
            content: "";
            grid-area: 1/1;
            margin: 2px;
            border: inherit;
            border-radius: 50%;
        }
        .loader::before {
            border-color: #f03355 #0000;
            animation: inherit;
            animation-duration: .5s;
            animation-direction: reverse;
        }
        .loader::after {
            margin: 8px;
        }
        @keyframes l16 {
            100% {
                transform: rotate(1turn);
            }
        }
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        .particle {
            position: absolute;
            background: var(--accent-primary);
            border-radius: 50%;
            opacity: 0.5;
            animation: float 3s linear infinite;
        }
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 0.15; }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        #background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            background-image: var(--grid-pattern);
            background-size: 20px 20px;
            z-index: -1;
            opacity: 0.3;
        }
        #background-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--scan-line);
            animation: scan 2s linear infinite;
            pointer-events: none;
        }
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        body {
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.4;
            --current-padding: var(--sidebar-width);
            padding-left: var(--current-padding);
            transition: var(--transition-smooth);
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }
        body.sidebar-collapsed {
            --current-padding: var(--sidebar-collapsed-width);
        }
        body.sidebar-hidden {
            --current-padding: 0;
        }
        /* ===== SIDEBAR STYLES ===== */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border);
            padding: 1.5rem 1rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: inset 1px 0 1px rgb(255, 255, 255), 2px 0 20px rgba(75, 74, 74, 0.153);
        }
        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
            align-items: center;
        }
        .sidebar.collapsed .sidebar-title,
        .sidebar.collapsed .sidebar-subtitle,
        .sidebar.collapsed .sidebar-nav-link .label {
            display: none;
        }
        .sidebar.collapsed .sidebar-logos img {
            width: 46px;
            height: 46px;
        }
        .sidebar .sidebar-nav-link { padding-left: 1rem; }
        .sidebar.collapsed .sidebar-nav-link { justify-content: center; padding: 1rem 0; }
        .sidebar.collapsed .sidebar-nav-link::after {
            content: attr(data-tooltip);
            position: absolute;
            left: calc(var(--sidebar-collapsed-width) + 12px);
            white-space: nowrap;
            background: rgba(0,0,0,0.85);
            color: #fff;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            transform: translateY(-50%);
            top: 50%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.18s ease, left 0.18s ease;
            box-shadow: 0 6px 18px rgba(0,0,0,0.5);
            z-index: 1200;
        }
        .sidebar.collapsed .sidebar-nav-link:hover::after { opacity: 1; left: calc(var(--sidebar-collapsed-width) + 18px); }
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            text-align: left;
            margin-bottom: 0.25rem;
            color: var(--accent-primary);
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .sidebar-subtitle {
            display: block;
            font-size: 0.95rem;
            font-weight: 400;
            text-align: left;
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
            line-height: 1.35;
            opacity: 0.95;
        }
        .sidebar-nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem 1.2rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }
        .sidebar-submenu .sidebar-nav-link {
            padding-left: 2.2rem;
            font-size: 0.95rem;
            background: transparent;
            color: var(--text-secondary);
        }
        .sidebar-nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            transition: left 0.4s ease;
            z-index: -1;
        }
        .sidebar-nav-link:hover {
            color: var(--text-primary);
        }
        .sidebar-nav-link.active {
            background: var(--accent-gradient);
            color: var(--bg-primary);
            font-weight: 600;
        }
        .sidebar-nav-link i {
            width: 24px;
            text-align: center;
        }
        .sidebar-toggle {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1001;
            background: var(--accent-gradient);
            color: var(--bg-primary);
            border: none;
            padding: 0.9rem 1rem;
            border-radius: var(--border-radius);
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
            width: 50px;
            height: 50px;
            display: none;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            min-height: 50px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .sidebar-toggle::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            cursor: pointer;
            z-index: -1;
        }
        .sidebar-toggle:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 0, 0, 0.4);
        }
        .sidebar-toggle:hover {
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
        }
        .sidebar-toggle i {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }
        .sidebar.active ~ .sidebar-toggle i {
            transform: rotate(90deg);
        }
        .main-content, .developer-content {
            padding: 2rem;
            transition: transform 0.30s ease, padding-left 0.30s ease, margin-right 0.30s ease;
            transform-origin: top left;
        }
        body.sidebar-collapsed .main-content,
        body.sidebar-collapsed .developer-content {
            padding-left: 3rem;
            margin-right: 3rem;
        }
        .search-box {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 1rem;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            color: var(--text-primary);
        }
        #clearCacheBtn:hover {
            background: #ff0080;
            box-shadow: 0 0 15px rgba(255, 0, 128, 0.6);
            transform: scale(1.05);
        }
        #clearCacheBtn:active {
            transform: scale(0.98);
        }
        .letter-section {
            margin-bottom: 2.5rem;
        }
        .letter-header {
            font-size: 1.8rem;
            margin: 1.5rem 0 1rem;
            color: var(--accent-primary);
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.2rem;
        }
        .gallery-item {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }
        .gallery-item .loader {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
        }
        .modal .loader {
            margin: 1rem auto;
        }
        .search-loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            display: none;
        }
        .search-loading.show {
            display: block;
        }
        .gallery-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            display: block;
            background: #222;
        }
        .gallery-item-name {
            padding: 0.7rem;
            font-size: 0.95rem;
            text-align: center;
        }
        .gallery-item-date {
            padding: 0 0.7rem 0.7rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-align: center;
        }
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
            z-index: 2200;
        }
        .modal.show {
            display: flex;
        }
        .modal-dialog {
            max-width: 930px;
            width: 95%;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 14px;
            box-shadow: 0 20px 20px rgba(255, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .close-btn {
            position: absolute;
            right: 18px;
            top: 12px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 2rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .close-btn:hover {
            transform: scale(1.9);
        }
        .modal-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 10px;
            object-fit: contain;
            -webkit-user-drag: none;
            -webkit-touch-callout: none;
            pointer-events: auto;
            user-select: none;
            -webkit-user-select: none;
        }
        .modal-info {
            width: 100%;
            padding: 10px 6px;
        }
        .modal-name {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }
        .modal-date {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 0.4rem;
        }
        .modal-actions {
            margin-top: 0.6rem;
            text-align: center;
        }
        .download-btn {
            padding: 0.5rem 0.9rem;
            border-radius: 10px;
            border: none;
            background: var(--accent-primary);
            color: #fff;
            cursor: pointer;
            transition: var(--transition-smooth);
            transform: translateY(0);
            position: relative;
            overflow: hidden;
        }
        .download-btn:hover {
            box-shadow: 0 20px 15px rgba(255, 0, 0, 0.4);
        }
        .download-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .download-btn.loading::after {
            content: '';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.25);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.9s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .developer-content {
            padding: 2rem;
        }
        .sidebar-profile {
            max-width: 500px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 0, 0, 0.05));
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 20px 20px rgba(255, 0, 0, 0.4);
        }
        .sidebar-profile img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-primary);
        }
        .sidebar-profile > div:nth-of-type(1) {
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 0.8rem;
        }
        .sidebar-logos {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .sidebar-logos img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-primary);
            box-shadow: 0 20px 20px rgba(177, 177, 177, 0.4);
        }
        .settings-toggle {
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 10px;
            transition: var(--transition-smooth);
            padding: 0.5rem;
            border-radius: var(--border-radius);
        }
        .settings-toggle:hover {
            background: var(--glass-bg);
            box-shadow: var(--glow-primary);
        }
        .sidebar-settings {
            margin: 1rem 0;
            padding: 1rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            display: none;
        }
        .sidebar.collapsed .sidebar-settings,
        .sidebar.collapsed .settings-toggle {
            display: none;
        }
        .sidebar-profile p {
            color: var(--text-secondary);
            margin-top: 0.8rem;
            line-height: 1.6;
        }
        .sidebar-profile a {
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.7rem 1.2rem;
            background: #25D366;
            color: #fff;
            border-radius: 999px;
            margin-top: 0.8rem;
            text-decoration: none;
            transition: var(--transition-smooth);
        }
        .sidebar-profile a:hover {
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.4);
        }
        .keyboard-shortcuts-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
            max-width: 250px;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }
        .keyboard-shortcuts-hint.show {
            opacity: 1;
            visibility: visible;
        }
        .keyboard-shortcuts-hint h4 {
            color: var(--accent-primary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        .keyboard-shortcuts-hint p {
            margin: 0.3rem 0;
            line-height: 1.4;
        }
        .keyboard-shortcuts-hint kbd {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 3px;
            padding: 2px 6px;
            font-family: monospace;
            color: var(--text-primary);
            font-size: 0.8rem;
        }
        /* === CONTENT PROTECTION === */
        body, * {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
        }
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        img {
            -webkit-user-drag: none;
            -webkit-touch-callout: none;
            pointer-events: auto;
        }
        @media (max-width: 768px) {
            body {
                padding-left: 0;
                padding-top: 50px;
            }
            .sidebar-toggle {
                display: flex;
            }
            .sidebar {
                width: 100%;
                left: -100%;
                transition: left 0.3s ease;
            }
            .sidebar.active {
                left: 0;
            }
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            .gallery-item img {
                height: 100px;
            }
        }

        /* === FAST MODE (disable animations/transitions) === */
        .fast-mode *,
        .fast-mode *::before,
        .fast-mode *::after {
            animation: none !important;
            transition: none !important;
        }
        .fast-mode {
            scroll-behavior: auto !important;
        }

        /* === PASTE BUTTON STYLE === */
        #pasteCodeBtn {
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
            transition: all 0.3s ease;
        }
        #pasteCodeBtn:hover {
            background: rgba(0, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.6), inset 0 0 10px rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        #pasteCodeBtn:active {
            transform: translateY(0);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.4);
        }

        /* === SCROLLING PHOTO BAR === */
        @keyframes scrollLeft {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        #scrollingPhotoBar {
            height: 200px;
            overflow: hidden;
            position: relative;
            margin: 1rem -2rem;
        }
        #scrollingPhotoBar img {
            height: 200px;
            width: auto;
            max-width: 300px;
            object-fit: cover;
            object-position: center;
            border-radius: 12px;
            border: 2px solid var(--glass-border);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
        }
        #scrollingPhotoBar .scrolling-container {
            display: flex;
            gap: 1.5rem;
            position: absolute;
            top: 0;
            left: 0;
            height: 200px;
            animation: scrollLeft 30s linear infinite;
        }
        /* Tombol di kiri ‚Äî seperti slot */
    #chatButton {
      position: fixed;
      bottom: 24px;
      left: 0;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 0 18px 18px 0;
      width: 56px;
      height: 56px;
      cursor: pointer;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      padding: 0;
      transition: width 0.25s ease;
    }
    #chatButton:hover { width: 64px; }

    /* Container chat */
    #chatContainer {
      position: fixed;
      bottom: 100px;
      left: -360px;
      width: 340px;
      height: 480px;
      background: #000;
      border-radius: 12px 12px 12px 4px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: left 0.45s cubic-bezier(0.33, 0.01, 0.2, 1);
    }
    #chatContainer.open { left: 20px; }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
      border-radius: 12px 12px 12px 4px;
    }

    /* Loader */
    .loader {
      width: 50px;
      aspect-ratio: 1;
      display: grid;
      border: 4px solid #0000;
      border-radius: 50%;
      border-color: #ccc #0000;
      animation: l16 1s infinite linear;
    }
    .loader::before,
    .loader::after {
      content: "";
      grid-area: 1/1;
      margin: 2px;
      border: inherit;
      border-radius: 50%;
    }
    .loader::before {
      border-color: #f03355 #0000;
      animation: inherit;
      animation-duration: 0.5s;
      animation-direction: reverse;
    }
    .loader::after {
      margin: 8px;
    }
    @keyframes l16 {
      100% { transform: rotate(1turn); }
    }

    /* Peringatan overlay */
    #warningOverlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 12px 12px 12px 4px;
      padding: 24px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 20;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    #warningOverlay p {
      font-family: 'Segoe UI', sans-serif;
      font-size: 15px;
      line-height: 1.5;
      color: #333;
      text-align: justify;
    }
    #warningOverlay button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 16px;
      transition: background 0.2s;
    }
    #warningOverlay button:hover {
      background: #45a049;
    }

    /* Mobile */
    @media (max-width: 767px) {
      #chatButton {
        width: 66px; height: 66px; bottom: 20px;
      }
      #chatButton:hover { width: 74px; }
      #chatContainer {
        width: 92vw;
        max-width: 350px;
        height: 62vh;
        max-height: 500px;
        left: calc(-92vw - 20px);
        border-radius: 16px 16px 16px 6px;
      }
      #chatContainer.open { left: 20px; }
      iframe, #warningOverlay { border-radius: 16px 16px 16px 6px; }
    }
    </style>
</head>
<body class="sidebar-hidden">
    <!-- LOADING SCREEN -->
    <div id="loading-screen">
        <div class="particles" id="particles"></div>
        <div class="loading-content">
            <i class="fa-solid fa-laptop-code fa-4x main-icon hidden slide-left"></i>
            <h1 id="loading-text" class="hidden slide-right"></h1>
            <div class="sub-icons">
                <i class="fa-brands fa-github fa-2x hidden scale-in"></i>
                <i class="fa-solid fa-code fa-2x hidden scale-in"></i>
                <i class="fa-solid fa-user fa-2x hidden scale-in"></i>
            </div>
            <h2 id="designer-text2" class="hidden fade-in">-</h2>
            <h2 id="designer-text" class="hidden fall">DEVELOPER : ZHYLLAN</h2>
        </div>
        <div class="loader"></div>
        </div>
    </div>

    <!-- LOGIN MODAL OVERLAY -->
    <div id="loginModal" style="position:fixed;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,0.85);z-index:9998;">
        <h2 style="color:#00ff88;margin-bottom:20px;">üîê Masukkan Kode Akses</h2>
            <div style="display:flex;gap:8px;align-items:center;">
                <input type="text" id="accessCode" placeholder="Contoh: AbC12-DeF34-GhI56-JkL78" style="padding:12px;width:300px;text-align:center;background:#111;color:#00ff88;border:1px solid #00ff88;border-radius:6px;">
                <button id="pasteCodeBtn" type="button" onclick="pasteAccessCode()" style="padding:10px 12px;background:var(--accent-primary);color:#000;border:none;border-radius:6px;cursor:pointer;">Tempel</button>
            </div>
            <div id="errorMsg" style="color:#ff6b6b;margin-top:12px;"></div>
        <div id="errorMsg" style="color:#ff6b6b;margin-top:12px;"></div>
        
        <!-- IDENTIFIKASI SECTION -->
        <div id="identifikasiSection" style="display:none;margin-top:25px;padding:20px;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);border-radius:8px;width:300px;text-align:left;">
            <h3 style="color:var(--accent-primary);margin-bottom:15px;font-size:1rem;">üìã Identifikasi :</h3>
            <p style="color:var(--text-secondary);margin:8px 0;"><strong>Nama :</strong></p>
            <p id="displayName" style="color:#00ff88;margin:5px 0 15px 0;background:rgba(0,0,0,0.5);padding:8px;border-radius:4px;word-break:break-all;"></p>
            <p style="color:var(--text-secondary);margin:8px 0;"><strong>Password :</strong></p>
            <p id="displayPasswordFinal" style="color:#00ff88;margin:5px 0 0 0;background:rgba(0,0,0,0.5);padding:8px;border-radius:4px;word-break:break-all;letter-spacing:2px;"></p>
        </div>

        <!-- BUTTONS: placed under identifikasi and preview -->
        <div style="display:flex;gap:12px;margin-top:18px;">
            <button id="loginConfirmBtn" onclick="verifyCode()" style="flex:1;padding:10px 20px;background:#ff0080;color:white;border:none;border-radius:6px;cursor:pointer;">Masuk</button>
            <button id="openMembersBtn" type="button" style="flex:1;padding:10px 20px;background:var(--accent-primary);color:#000;border:none;border-radius:6px;cursor:pointer;">Buka Tabel</button>
        </div>
    </div>

    <!-- MAIN APP (SIDEBAR + CONTENT) -->
    <div id="mainApp" style="display:none;">
        <button class="sidebar-toggle" id="sidebarToggle"><i class="fas fa-bars"></i></button>
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logos">
                <img src="https://i.ibb.co.com/twpD1fqr/Whats-App-Image-2025-11-16-at-12-05-11-0adeacb0.jpg" alt="Logo">
                <button class="settings-toggle" id="settingsToggle" title="Pengaturan"><i class="fas fa-cog"></i></button>
            </div>
            <div class="sidebar-title">Togetherness TKJ OnE</div>
            <div class="sidebar-subtitle">
                Koleksi Foto & Video Bersama Anggota TKJ 1
            </div>
            <div class="sidebar-settings" id="sidebarSettings">
                <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">Pengaturan</h4>
                <p style="color: var(--text-secondary); margin: 0.5rem 0;"><strong>Nama:</strong> <span id="settingsName">-</span></p>
                <p style="color: var(--text-secondary); margin: 0.5rem 0;"><strong>Password:</strong> <span id="settingsPassword">-</span></p>
                <p style="color: var(--text-secondary); margin: 0.5rem 0;"><strong>Nomor Urut:</strong> <span id="settingsOrder">-</span></p>
                <label style="display:flex;align-items:center;gap:10px;cursor:pointer;margin-top:1rem;">
                    <input id="fastModeToggle" type="checkbox" style="width:18px;height:18px;" />
                    <span style="color:var(--text-secondary);">Mode Fast (Tanpa Animasi)</span>
                </label>
                <p style="color:var(--text-secondary);font-size:0.9rem;margin-top:8px;">Aktifkan untuk menonaktifkan semua animasi dan transisi (berguna untuk perangkat lambat atau uji kecepatan).</p>
                <label style="display:flex;align-items:center;gap:10px;cursor:pointer;margin-top:1rem;">
                    <input id="scrollingPhotoBarToggle" type="checkbox" style="width:18px;height:18px;" checked />
                    <span style="color:var(--text-secondary);">Tampilkan Bar Foto Berjalan</span>
                </label>
                <p style="color:var(--text-secondary);font-size:0.9rem;margin-top:8px;">Aktifkan untuk menampilkan bar foto yang berjalan di atas galeri.</p>
                <button id="clearCacheBtn" style="padding:0.8rem 1.5rem;background:#ff0080;color:white;border:1px solid #ff0080;border-radius:4px;cursor:pointer;font-weight:bold;transition:all 0.3s;margin-top:1rem;" title="Hapus semua cache dan refresh">üóëÔ∏è Hapus Cache</button>
            </div>
            <nav>
                <a href="#" class="sidebar-nav-link" data-filter="all"><i class="fas fa-images"></i> <span class="label">SEMUA FOTO</span></a>
                <a href="#" class="sidebar-nav-link active" data-filter="group"><i class="fas fa-users"></i> <span class="label">FOTO BERSAMA</span></a>
                <a href="#" class="sidebar-nav-link" data-filter="male"><i class="fas fa-mars"></i> <span class="label">FOTO COWOK</span></a>
                <a href="#" class="sidebar-nav-link" data-filter="female"><i class="fas fa-venus"></i> <span class="label">FOTO CEWEK</span></a>
                <a href="#" class="sidebar-nav-link" data-filter="video"><i class="fas fa-video"></i> <span class="label">VIDEO</span></a>
                <a href="#" class="sidebar-nav-link" data-target="about"><i class="fas fa-user"></i> <span class="label">INFO DEVELOPER</span></a>
                <a href="#" class="sidebar-nav-link" data-target="members"><i class="fas fa-users-viewfinder"></i> <span class="label">ANGGOTA TKJ 1</span></a>
            </nav>
        </aside>

        <main class="main-content" id="section-all">
            <div id="security-notice" class="security-notice" style="text-align:center;margin:2rem 0;padding:2rem;background: rgba(0,0,0,0.8);border:1px solid rgba(255,255,255,0.1);border-radius:var(--border-radius);">
                <h3 style="color:var(--accent-primary);margin-bottom:1rem;">üîí Keamanan Konten</h3>
                <p style="color:var(--text-secondary);margin-bottom:1rem;">Foto-foto ini dilindungi. Dilarang keras mengambil screenshot atau menyebarkan tanpa izin.</p>
                <p style="color:#ff6b6b;font-size:0.9rem;margin-bottom:1rem;">‚ö†Ô∏è Pelanggaran akan di kenai sangsi</p>
                <button id="accept-security-btn" style="padding:0.5rem 1rem;border-radius:8px;border:none;background:var(--accent-primary);color:#fff;cursor:pointer;">Saya Mengerti & Lanjutkan</button>
            </div>
            <div id="searchWrapper" style="display:none;">
                <div style="display:flex;gap:10px;margin-bottom:1rem;flex-wrap:wrap;align-items:center;">
                    <input type="number" id="searchInput" class="search-box" placeholder="Cari sesuai tanggal atau nomor foto yang tersedia" style="flex:1;min-width:200px;">
                </div>
            </div>
            <div id="scrollingPhotoBar" style="display:none; overflow:hidden; height:120px; margin-bottom:1rem; position:relative; pointer-events:none;">
                <div id="scrollingInner" style="display:flex; gap:10px; animation: scrollLeft 30s linear infinite;"></div>
            </div>
            <h2 id="main-title" style="display:none;"></h2>
            <div class="sidebar-subtitle" id="main-subtitle" style="display:none;">
            </div>
            <div id="noResultsMessage" style="text-align:center;margin:2rem 0;color:var(--text-secondary);display:none;">
                Tanggal atau nomor foto: "<span id="searchedTerm"></span>" Tidak di temukan. Coba lagi dengan kata kunci lain.
            </div>
            <div id="searchLoadingContainer" class="search-loading">
                <p><div class="loader" style="margin-top:1rem;"></div></p>
                <p>Memuat hasil pencarian...</p>
            </div>
            <div id="galleryContainer"></div>
            <div id="statsFooter" style="margin-top:2rem;padding:1.5rem;background:rgba(0,255,136,0.05);border:1px solid rgba(0,255,136,0.2);border-radius:4px;text-align:center;color:var(--text-secondary);">
                <span id="photoStats">Total: 0 foto | Ditampilkan: 0 foto</span>
            </div>
        </main>

        <main class="developer-content" id="section-about" style="display:none;">
            <div class="sidebar-profile">
                <img src="https://i.ibb.co.com/Fqy0Dgdj/4-Nov-14-35-lmc-8-4-1.jpg" alt="Zhyllan">
                <div>ZHYLLAN FYLLAH</div>
                <p><blockquote></blockquote></p>
                <a href="https://jirankun.github.io/portofoliozhyllan" target="_blank">
                    <i class="fas fa-user"></i> Buka Web folio Developer
                </a>

            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div class="modal" id="imageModal" onclick="closeModal()">
        <div class="modal-dialog" onclick="event.stopPropagation()">
            <button class="close-btn" aria-label="Tutup" onclick="closeModal()">&times;</button>
            <div id="modalLoadingContainer" class="loader" style="display:none;"></div>
            <img id="modalImage" class="modal-image" src="" alt="Gambar">
            <video id="modalVideo" class="modal-image" src="" alt="Video" controls style="display:none;"></video>
            <div class="modal-info">
                <div id="modalName" class="modal-name"></div>
                <div id="modalDate" class="modal-date"></div>
                <div class="modal-actions">
                    <button id="downloadBtn" class="download-btn" onclick="downloadImage()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MEMBERS MODAL -->
    <div class="modal" id="membersModal" onclick="closeMembersModal()">
        <div class="modal-dialog" style="max-width: 700px; max-height: 80vh; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch;" onclick="event.stopPropagation()">
            <button class="close-btn" aria-label="Tutup" onclick="closeMembersModal()">&times;</button>
            <h2 style="color: var(--text-primary); margin-bottom: 20px; text-align: center;">ANGGOTA TKJ 1</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #00ff88, #00ffff); color: #000; font-weight: bold;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #00ff88;">No</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #00ff88;">Nama Anggota</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <!-- Akan diisi dengan JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- KEYBOARD SHORTCUTS HINT -->
    <div class="keyboard-shortcuts-hint" id="keyboardShortcutsHint">
        <h4>‚å®Ô∏è Keyboard Shortcuts</h4>
        <p><kbd>C</kbd> - Toggle Sidebar</p>
        <p><kbd>M</kbd> - Menu (Mobile)</p>
        <p><kbd>D</kbd> - Download (Modal)</p>
        <p><kbd>ESC</kbd> - Close Modal</p>
        <p><kbd>R</kbd> - Clear Cache</p>
        <p><kbd>?</kbd> - Help</p>
    </div>

      <button id="chatButton">
    <img
      src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11/icons/chat-fill.svg"
      alt="Chat"
      style="width: 26px; height: 26px; filter: invert(1);"
    />
  </button>

  <div id="chatContainer">
    <div class="loader"></div>
    <iframe id="chatIframe" scrolling="no"></iframe>
  </div>

    <script>
        // === DOWNLOAD HANDLER ===
        function downloadImage() {
            try {
                const img = document.getElementById('modalImage');
                const video = document.getElementById('modalVideo');
                const downloadBtn = document.getElementById('downloadBtn');
                
                if (!downloadBtn) return;
                
                let fileUrl = '';
                let fileName = document.getElementById('modalName').textContent || 'download';
                
                // Tentukan URL file (gambar atau video)
                if (img && img.style.display !== 'none' && img.src) {
                    fileUrl = img.src;
                    fileName = fileName + '.jpg';
                } else if (video && video.style.display !== 'none' && video.src) {
                    fileUrl = video.src;
                    fileName = fileName + '.mp4';
                }
                
                if (!fileUrl) {
                    alert('‚ùå File tidak ditemukan');
                    return;
                }
                
                // Update button state
                const originalHTML = downloadBtn.innerHTML;
                downloadBtn.disabled = true;
                downloadBtn.classList.add('loading');
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mendownload...';

                // Try fetch+blob first for normal browsers, fallback to opening the file URL
                fetch(fileUrl).then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.blob();
                }).then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('loading');
                    downloadBtn.innerHTML = originalHTML;
                    alert('‚úÖ Download selesai!');
                }).catch(err => {
                    console.warn('Blob download failed, falling back to open URL:', err);
                    // Some environments (webviews like Kodular) handle file URLs differently ‚Äî open in new tab/window
                    try {
                        window.open(fileUrl, '_blank');
                        alert('Jika unduhan otomatis tidak berlangsung, file dibuka di tab baru.');
                    } catch (openErr) {
                        console.error('Fallback open failed:', openErr);
                        alert('‚ùå Gagal mendownload file: ' + err.message);
                    }
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('loading');
                    downloadBtn.innerHTML = originalHTML;
                });
            } catch (e) {
                console.error('Error in downloadImage:', e);
                alert('‚ùå Terjadi kesalahan: ' + e.message);
            }
        }

        const chatButton = document.getElementById('chatButton');
    const chatContainer = document.getElementById('chatContainer');
    const chatIframe = document.getElementById('chatIframe');
    const loader = chatContainer.querySelector('.loader');

    // Cek apakah user sudah pernah setuju
    const hasAgreedBefore = localStorage.getItem('chat_agreed') === 'true';
    let hasAgreed = hasAgreedBefore;
    let hasLoaded = false;
    let isOpen = false;

    // Fungsi buat overlay peringatan
    function showWarning() {
      const overlay = document.createElement('div');
      overlay.id = 'warningOverlay';
      overlay.innerHTML = `
        <p>
          Dimohon jangan ada trik spam dan mengirim kata-kata yang mengandung unsur SARA 
          dan penyelewengan akhlak. Jangan mengirim link yang berbahaya dan negatif.
        </p>
        <button id="agreeButton">Saya Mengerti</button>
      `;
      chatContainer.appendChild(overlay);

      document.getElementById('agreeButton').addEventListener('click', () => {
        hasAgreed = true;
        localStorage.setItem('chat_agreed', 'true');
        overlay.remove();
        // Mulai muat iframe
        loadChat();
      });
    }

    // Fungsi muat iframe
    function loadChat() {
      if (!hasLoaded) {
        chatIframe.src = 'https://organizations.minnit.chat/700753906889005/c/Main?embed';
        chatIframe.onload = () => {
          loader.style.display = 'none';
          chatIframe.style.display = 'block';
          hasLoaded = true;
        };
        chatIframe.onerror = () => {
          loader.style.display = 'none';
          chatIframe.style.display = 'block';
          chatContainer.innerHTML = `
            <div style="color:#d32f2f;text-align:center;padding:20px;font-family:sans-serif;line-height:1.4;">
              ‚ö†Ô∏è Tidak dapat memuat chat.<br>
              Pastikan JavaScript aktif dan akses via browser.
            </div>
          `;
        };
      } else {
        loader.style.display = 'none';
        chatIframe.style.display = 'block';
      }
    }

    // Toggle buka/tutup
    chatButton.addEventListener('click', () => {
      if (isOpen) {
        chatContainer.classList.remove('open');
        setTimeout(() => {
          chatContainer.style.display = 'flex';
        }, 450);
        isOpen = false;
      } else {
        chatContainer.style.display = 'flex';
        setTimeout(() => {
          chatContainer.classList.add('open');
        }, 10);
        isOpen = true;

        // Tampilkan konten sesuai status
        if (hasAgreed) {
          // Langsung muat chat
          loadChat();
        } else {
          // Tampilkan peringatan
          showWarning();
        }
      }
    });

        // Paste helper for login modal ‚Äî attempts clipboard API, falls back to prompt
        function pasteAccessCode() {
            const input = document.getElementById('accessCode');
            const err = document.getElementById('errorMsg');
            if (!input) return;
            err.textContent = '';
            if (navigator.clipboard && navigator.clipboard.readText) {
                navigator.clipboard.readText().then(text => {
                    if (text) {
                        input.value = text.trim();
                    } else {
                        err.textContent = 'Clipboard kosong atau tidak ada teks.';
                    }
                }).catch(cbErr => {
                    console.warn('Clipboard read failed', cbErr);
                    // fallback: ask user to paste manually via prompt
                    const manual = prompt('Tempelkan kode akses di sini:');
                    if (manual !== null) input.value = manual;
                });
            } else {
                // Fallback for webviews that don't expose clipboard API
                const manual = prompt('Tidak dapat mengakses clipboard. Tempelkan kode akses di sini:');
                if (manual !== null) input.value = manual;
            }
        }

        // ‚úÖ DAFTAR NAMA YANG DIIZINKAN (ISI SESUAI KEBUTUHANMU)
        const ALLOWED_NAMES = [
            "Abiyu Anugrah",
            "Aktsar Hakim Nst",
            "Amalia Safitri",
            "Amir Hamzah",
            "Asra Bilhuda",
            "Eli Zahara",
            "Ezyla Aziz Zeira",
            "Fadel Muhammad Rezki",
            "Faizul Adzimi",
            "Faldho Adzani",
            "Fitria Mulia",
            "Galang Luqmanul Hakim",
            "Hafif Mabrur",
            "Kasifa Rahmah",
            "Keysa Putri Ramadani",
            "M. Rafiki Rasli",
            "Muhammad Hibban Aulia",
            "Muhammad Yudha Pratama",
            "Najia Atika Sahira",
            "Najwa Asyifa",
            "Rafi Idham",
            "Ranti Amelia",
            "Rasima Handayani",
            "Reviansyah",
            "Reza Ardiansyah",
            "Sakinah Khanza",
            "Salimah",
            "Salsa Bila",
            "Susi Saskia",
            "Syah Ratul Faiza",
            "Thalita Syafa Harahap",
            "Tonius Nduru",
            "Yennisa Mulia",
            "Yuda Setriawan",
            "Zhyllan Fyllah"
        ];

        // === Fungsi dekripsi kode akses ===
        function hashPass(pass) {
            let h = 0;
            for (let c of pass) h = Math.imul(h ^ c.charCodeAt(), 1540483477) >>> 0;
            return h;
        }
        const CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        function codeToText(code, pass) {
            let clean = code.replace(/-/g, '');
            if (clean.length % 2 !== 0) throw new Error("Kode rusak");
            const seed = hashPass(pass);
            let out = '';
            for (let i = 0; i < clean.length; i += 2) {
                const a = CHARS.indexOf(clean[i]);
                const b = CHARS.indexOf(clean[i+1]);
                if (a === -1 || b === -1) throw new Error("Karakter tidak valid");
                const val = a * CHARS.length + b;
                const offset = (seed + (i/2) * 41) % CHARS.length;
                const orig = (val - offset + 256) % 256;
                out += String.fromCharCode(orig);
            }
            return out;
        }

        // === Verifikasi kode akses ===
        // === Fungsi Paste dari Clipboard ===
        async function pasteCodeFromClipboard() {
            try {
                // Coba menggunakan Clipboard API modern
                const text = await navigator.clipboard.readText();
                document.getElementById('accessCode').value = text.trim();
                document.getElementById('errorMsg').textContent = "‚úÖ Kode berhasil ditempel!";
                document.getElementById('errorMsg').style.color = '#00ff88';
                setTimeout(() => {
                    document.getElementById('errorMsg').textContent = '';
                }, 2000);
            } catch (err) {
                // Fallback untuk browser yang tidak support Clipboard API
                document.getElementById('errorMsg').textContent = "‚ùå Gagal mengakses clipboard. Pastikan browser mengizinkan akses.";
                document.getElementById('errorMsg').style.color = '#ff6b6b';
                console.error('Clipboard error:', err);
            }
        }

        function verifyCode() {
            const code = document.getElementById('accessCode').value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const SHARED_SECRET = "tkjone";
            if (!code) {
                errorMsg.textContent = "‚ö†Ô∏è Masukkan kode akses!";
                return;
            }
            try {
                const name = codeToText(code, SHARED_SECRET);
                if (ALLOWED_NAMES.includes(name)) {
                    // Simpan user info
                    localStorage.setItem('logged_in_user', name);
                    localStorage.setItem('user_code', code);
                    
                    // Tampilkan identifikasi
                    const identifikasiSection = document.getElementById('identifikasiSection');
                    const displayName = document.getElementById('displayName');
                    const displayPasswordFinal = document.getElementById('displayPasswordFinal');
                    
                    if (identifikasiSection && displayName && displayPasswordFinal) {
                        displayName.textContent = name;
                        displayPasswordFinal.textContent = code;
                        identifikasiSection.style.display = 'block';
                    }
                    
                    // Set timeout 3 detik sebelum redirect
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('loginModal').style.display = 'none';
                        document.getElementById('mainApp').style.display = 'block';
                        showMainContent();
                    }, 3000);
                } else {
                    errorMsg.textContent = "‚ùå Nama tidak dikenali. Akses ditolak.";
                }
            } catch (e) {
                errorMsg.textContent = "‚ùå Kode tidak valid.";
                console.error(e);
            }
        }



        // === Cek apakah sudah login ===
        function checkLoggedInUser() {
            const user = localStorage.getItem('logged_in_user');
            if (user) {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                showMainContent();
                return true;
            }
            return false;
        }

        // === Tampilkan konten utama ===
        function showMainContent() {
            document.body.classList.remove('sidebar-hidden');
            populateSettings();
        }

        // === Populate settings menu ===
        function populateSettings() {
            const user = localStorage.getItem('logged_in_user');
            const code = localStorage.getItem('user_code');
            if (user && code) {
                const order = ALLOWED_NAMES.indexOf(user) + 1;
                document.getElementById('settingsName').textContent = user;
                document.getElementById('settingsPassword').textContent = code;
                document.getElementById('settingsOrder').textContent = order;
            }
        }

        // === Settings toggle ===
        document.addEventListener('DOMContentLoaded', () => {
            const settingsToggle = document.getElementById('settingsToggle');
            const sidebarSettings = document.getElementById('sidebarSettings');
            if (settingsToggle && sidebarSettings) {
                settingsToggle.addEventListener('click', () => {
                    sidebarSettings.style.display = sidebarSettings.style.display === 'block' ? 'none' : 'block';
                });
            }
        });

        // === Security notice ===
        document.getElementById('accept-security-btn').addEventListener('click', () => {
            const notice = document.getElementById('security-notice');
            notice.style.display = 'none';
            document.getElementById('searchWrapper').style.display = 'block';
            document.getElementById('main-title').style.display = 'block';
            document.getElementById('main-subtitle').style.display = 'block';
            localStorage.setItem('security_accepted', JSON.stringify({ timestamp: Date.now() }));
            loadPhotosFromDB();
        });

        // === Cek cache security ===
        function checkSecurityCache() {
            const cached = localStorage.getItem('security_accepted');
            if (cached) {
                try {
                    const { timestamp } = JSON.parse(cached);
                    if (Date.now() - timestamp < 24 * 60 * 60 * 1000) {
                        document.getElementById('security-notice').style.display = 'none';
                        document.getElementById('searchWrapper').style.display = 'block';
                        document.getElementById('main-title').style.display = 'block';
                        document.getElementById('main-subtitle').style.display = 'block';
                        loadPhotosFromDB();
                        return true;
                    }
                } catch (e) {}
            }
            return false;
        }

        // === LONG PRESS STATE UNTUK TOMBOL BUKA TABEL ===
        let openMembersBtn_pressTimer = null;
        let openMembersBtn_isLongPress = false;
        let openMembersBtn_modeGetCode = false;

        function setupOpenMembersBtnLongPress() {
            const btn = document.getElementById('openMembersBtn');
            if (!btn) return;

            btn.addEventListener('mousedown', (e) => {
                openMembersBtn_isLongPress = false;
                openMembersBtn_pressTimer = setTimeout(() => {
                    openMembersBtn_isLongPress = true;
                    openMembersBtn_modeGetCode = !openMembersBtn_modeGetCode;
                    updateOpenMembersBtnDisplay();
                }, 800);
            });

            btn.addEventListener('mouseup', (e) => {
                if (openMembersBtn_pressTimer) {
                    clearTimeout(openMembersBtn_pressTimer);
                    openMembersBtn_pressTimer = null;
                }
                
                if (!openMembersBtn_isLongPress) {
                    if (openMembersBtn_modeGetCode) {
                        window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
                    } else {
                        openMembersModal();
                    }
                }
            });

            btn.addEventListener('mouseleave', () => {
                if (openMembersBtn_pressTimer) {
                    clearTimeout(openMembersBtn_pressTimer);
                    openMembersBtn_pressTimer = null;
                }
                openMembersBtn_isLongPress = false;
            });

            // Touch support
            btn.addEventListener('touchstart', (e) => {
                openMembersBtn_isLongPress = false;
                openMembersBtn_pressTimer = setTimeout(() => {
                    openMembersBtn_isLongPress = true;
                    openMembersBtn_modeGetCode = !openMembersBtn_modeGetCode;
                    updateOpenMembersBtnDisplay();
                }, 800);
            });

            btn.addEventListener('touchend', (e) => {
                if (openMembersBtn_pressTimer) {
                    clearTimeout(openMembersBtn_pressTimer);
                    openMembersBtn_pressTimer = null;
                }
                
                if (!openMembersBtn_isLongPress) {
                    if (openMembersBtn_modeGetCode) {
                        window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
                    } else {
                        openMembersModal();
                    }
                }
            });
        }

        function updateOpenMembersBtnDisplay() {
            const btn = document.getElementById('openMembersBtn');
            if (!btn) return;
            
            if (openMembersBtn_modeGetCode) {
                btn.textContent = 'üîë Minta Kode';
                btn.style.background = '#ff0080';
                btn.style.color = 'white';
            } else {
                btn.textContent = 'Buka Tabel';
                btn.style.background = 'var(--accent-primary)';
                btn.style.color = '#000';
            }
        }

        // === Loading screen animation ===
        document.addEventListener("DOMContentLoaded", () => {
            const loadingText = document.getElementById("loading-text");
            const mainIcon = document.querySelector(".main-icon");
            const subIcons = document.querySelectorAll(".sub-icons i");
            const designerText = document.getElementById("designer-text");
            const designerText2 = document.getElementById("designer-text2");
            const loadingScreen = document.getElementById("loading-screen");
            const loader = document.querySelector("#loading-screen .loader");
            if (loader) loader.classList.add('show');

            function showElement(el, delay) {
                if (!el) return;
                // Consider fast-mode from body class or persisted setting ‚Äî read localStorage to ensure early application
                const isFast = document.body.classList.contains('fast-mode') || localStorage.getItem('fastMode') === '1';
                setTimeout(() => {
                    el.classList.remove("hidden");
                    if (!isFast) {
                        if (el.classList.contains("slide-left")) el.classList.add("animate-slide-left");
                        else if (el.classList.contains("slide-right")) el.classList.add("animate-slide-right");
                        else if (el.classList.contains("scale-in")) el.classList.add("animate-scale-in");
                        else if (el.classList.contains("fade-in")) el.classList.add("animate-fade-in");
                        else if (el.classList.contains("fall")) el.classList.add("animate-fall");
                    }
                }, delay);
            }

            function typeWriter() {
                // In normal mode show full title with typing; in fast-mode show simplified title
                const fullText = "Togetherness TKJ OnE";
                const fastText = "TKJ OnE";
                const isFast = document.body.classList.contains('fast-mode') || localStorage.getItem('fastMode') === '1';
                if (isFast) {
                    loadingText.textContent = fastText;
                    return;
                }
                loadingText.textContent = "";
                let i = 0;
                const timer = setInterval(() => {
                    if (i < fullText.length) {
                        loadingText.textContent += fullText.charAt(i++);
                    } else {
                        clearInterval(timer);
                    }
                }, 100);
            }

            const isFastImmediate = document.body.classList.contains('fast-mode') || localStorage.getItem('fastMode') === '1';
            typeWriter();
            showElement(loadingText, 0);
            if (!isFastImmediate) {
                showElement(mainIcon, 800);
                subIcons.forEach((icon, i) => showElement(icon, 1600 + i * 400));
                showElement(designerText2, 3200);
                showElement(designerText, 3600);
            } else {
                // fast-mode: show only simplified title and hide other opening visuals
                if (mainIcon) mainIcon.classList.add('hidden');
                subIcons.forEach((icon) => icon.classList.add('hidden'));
                if (designerText2) designerText2.classList.add('hidden');
                if (designerText) designerText.classList.add('hidden');
            }

            const particlesContainer = document.getElementById('particles');
            if (!isFastImmediate) {
                for (let i = 0; i < 25; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 110 + '%';
                    particle.style.width = Math.random() * 80 + 5 + 'px';
                    particle.style.height = particle.style.width;
                    particle.style.animationDelay = Math.random() * 8 + 's';
                    particlesContainer.appendChild(particle);
                }
            }

            // Hide loading screen faster in fast-mode
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    if (!checkLoggedInUser()) {
                        document.getElementById('loginModal').style.display = 'flex';
                        checkSecurityCache();
                    }
                    // Setup long press untuk tombol Buka Tabel
                    setupOpenMembersBtnLongPress();
                }, isFastImmediate ? 50 : 1000);
            }, isFastImmediate ? 50 : 5500);
        });

        // === FILTER & GALLERY LOGIC (PERBAIKAN UTAMA) ===
        let currentFilter = 'group';
        // Keep track of previous sidebar selection so we can restore it after opening the members modal
        let previousSidebarActive = null;
        let photos = [];

        // loadFromLocal - dummy fallback
        async function loadFromLocal() {
            try {
                const response = await fetch('./DB/photos.json');
                if (!response.ok) throw new Error();
                const data = await response.json();
                return data.photos;
            } catch (e) {
                return [{ name: "Zhyllan", gender: "male", url: "https://i.ibb.co/Fqy0Dgdj/4-Nov-14-35-lmc-8-4-1.jpg", date: "2025-11-04" }];
            }
        }

        async function loadPhotosFromDB() {
            try {
                photos = await loadFromLocal();
                if (!Array.isArray(photos)) {
                    console.warn('Photos data is not an array, using fallback');
                    photos = [];
                }
                initializeScrollingPhotoBar();
                performSearch('');
            } catch (err) {
                console.error('Error loading photos:', err);
                photos = [];
                performSearch('');
            }
        }

        function initializeScrollingPhotoBar() {
            const bar = document.getElementById('scrollingPhotoBar');
            const inner = document.getElementById('scrollingInner');
            if (!bar || !inner) return;

            // Get current month
            const now = new Date();
            const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

            // Filter photos from current month
            const currentMonthPhotos = photos.filter(p => p.date && p.date.startsWith(currentMonth));

            if (currentMonthPhotos.length === 0) return;

            // Shuffle and select up to 10 photos
            const shuffled = currentMonthPhotos.sort(() => 0.5 - Math.random());
            const selectedPhotos = shuffled.slice(0, Math.min(10, shuffled.length));

            // Duplicate for seamless scrolling
            const allPhotos = [...selectedPhotos, ...selectedPhotos];

            inner.innerHTML = '';
            allPhotos.forEach(photo => {
                const img = document.createElement('img');
                img.src = photo.url;
                img.alt = photo.name;
                inner.appendChild(img);
            });

            bar.style.display = 'block';
        }

        function performSearch(query) {
            try {
                // Tampilkan loading saat pencarian
                const searchLoadingContainer = document.getElementById('searchLoadingContainer');
                if (searchLoadingContainer) {
                    searchLoadingContainer.classList.add('show');
                    const loader = searchLoadingContainer.querySelector('.loader');
                    if (loader) loader.classList.add('show');
                }

                let results = [...(photos || [])];
                if (query.trim()) {
                    results = results.filter(p =>
                        (p.name && p.name.toLowerCase().includes(query.toLowerCase())) ||
                        (p.date && formatDate(p.date).includes(query.replace(/\D/g, '')))
                    );
                }

                // ‚úÖ PERBAIKAN FILTER "GROUP" ‚Üí tampilkan SEMUA
                if (currentFilter === 'male') {
                    results = results.filter(p => p.gender === 'male');
                } else if (currentFilter === 'female') {
                    results = results.filter(p => p.gender === 'female');
                } else if (currentFilter === 'video') {
                    results = results.filter(p => p.gender === 'video');
                }
                // Jika 'group' atau 'all' ‚Üí tidak filter

                // Delay kecil untuk smooth transition
                setTimeout(() => {
                    renderGallery(results);
                }, 100);
            } catch (err) {
                console.error('Search error:', err);
                const searchLoadingContainer = document.getElementById('searchLoadingContainer');
                if (searchLoadingContainer) {
                    searchLoadingContainer.classList.remove('show');
                    const loader = searchLoadingContainer.querySelector('.loader');
                    if (loader) loader.classList.remove('show');
                }
                renderGallery([]);
            }
        }

        function formatDate(dateStr) {
            if (!dateStr) return '';
            const [y, m, d] = dateStr.split('-');
            return `${d}-${m}-${y}`;
        }

        function renderGallery(filteredPhotos) {
            const container = document.getElementById('galleryContainer');
            const noResultsMsg = document.getElementById('noResultsMessage');
            const searchLoadingContainer = document.getElementById('searchLoadingContainer');
            const currentQuery = document.getElementById('searchInput').value.trim();

            // Sembunyikan loading setelah selesai
            if (searchLoadingContainer) {
                searchLoadingContainer.classList.remove('show');
            }

            // Update statistik
            const photoStats = document.getElementById('photoStats');
            if (photoStats) {
                const totalPhotos = photos.filter(p => p.gender !== 'video').length;
                const totalVideos = photos.filter(p => p.gender === 'video').length;
                const displayedPhotos = filteredPhotos.filter(p => p.gender !== 'video').length;
                const displayedVideos = filteredPhotos.filter(p => p.gender === 'video').length;
                photoStats.textContent = `Total: ${totalPhotos} foto | ${totalVideos} video | Ditampilkan: ${displayedPhotos} foto | ${displayedVideos} video`;
            }

            if (filteredPhotos.length === 0 && currentQuery) {
                document.getElementById('searchedTerm').textContent = currentQuery;
                noResultsMsg.style.display = 'block';
                container.innerHTML = '';
                return;
            }

            noResultsMsg.style.display = 'none';
            container.innerHTML = '';
            const groups = {};
            filteredPhotos.forEach(photo => {
                const letter = (photo.name || '?').charAt(0).toUpperCase();
                if (!groups[letter]) groups[letter] = [];
                groups[letter].push(photo);
            });

            Object.keys(groups).sort().forEach(letter => {
                const section = document.createElement('div');
                section.className = 'letter-section';
                section.innerHTML = `<h2 class="letter-header">${letter}</h2><div class="gallery-grid" id="grid-${letter}"></div>`;
                container.appendChild(section);
                const grid = section.querySelector(`#grid-${letter}`);
                groups[letter].forEach(photo => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    const formattedDate = formatDate(photo.date);
                    item.innerHTML = `
                        <img src="${photo.url}" alt="${photo.name}" style="width:100%;height:180px;object-fit:cover;background:#222;">
                        <div class="gallery-item-name">${photo.name}</div>
                        <div class="gallery-item-date">${formattedDate}</div>
                    `;
                    item.onclick = () => openModal(photo.url, photo.name, photo.date, photo.gender);
                    grid.appendChild(item);
                });
            });
        }

        // === DETEKSI DESKTOP ===
        function isDesktop() {
            // Deteksi desktop berdasarkan lebar layar dan tidak ada touch capability
            return window.innerWidth > 768 && !('ontouchstart' in window);
        }

        // === MODAL ===
        function openModal(url, name, date, gender) {
            try {
                const modal = document.getElementById('imageModal');
                const img = document.getElementById('modalImage');
                const video = document.getElementById('modalVideo');
                const modalLoading = document.getElementById('modalLoadingContainer');
                const isVideo = gender === 'video' || /\.(mp4|avi|mov|wmv|flv|webm|mkv)$/i.test(url || '');

                document.getElementById('modalName').textContent = name || 'No name';
                document.getElementById('modalDate').textContent = date ? formatDate(date) : 'No date';

                img.style.display = 'none';
                video.style.display = 'none';
                if (modalLoading) {
                    modalLoading.classList.add('show');
                }

                const downloadBtn = document.getElementById('downloadBtn');
                if (isVideo) {
                    video.style.display = 'block';
                    video.src = url || '';
                    video.onloadstart = () => {
                        if (modalLoading) modalLoading.classList.add('show');
                    };
                    video.oncanplay = () => {
                        if (modalLoading) modalLoading.classList.remove('show');
                    };
                    // Hide download button for video items (use native player controls)
                    if (downloadBtn) downloadBtn.style.display = 'none';
                } else {
                    img.style.display = 'block';
                    img.src = url || '';
                    img.onload = () => {
                        if (modalLoading) modalLoading.classList.remove('show');
                    };
                    img.onerror = () => {
                        if (modalLoading) modalLoading.classList.remove('show');
                        console.error('Failed to load image');
                    };
                    // Hide download button on desktop
                    if (downloadBtn) {
                        downloadBtn.style.display = isDesktop() ? 'none' : '';
                    }
                }

                modal.classList.add('show');
                // lock body scroll (handles Android touchmove prevention too)
                updateBodyLockState();
            } catch (e) {
                console.error('Error opening modal:', e);
                alert('Gagal membuka media: ' + e.message);
            }
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('show');
            // update lock state (will unlock if nothing else requires lock)
            updateBodyLockState();
        }

        function openMembersModal() {
            const modal = document.getElementById('membersModal');
            const tbody = document.getElementById('membersTableBody');
            
            // Isi tabel dengan anggota
            tbody.innerHTML = ALLOWED_NAMES.map((name, index) => `
                <tr style="border: 1px solid #00ff88; ${index % 2 === 0 ? 'background: rgba(0, 255, 136, 0.05);' : ''}">
                    <td style="padding: 10px; color: var(--text-primary); font-weight: bold;">${index + 1}</td>
                    <td style="padding: 10px; color: var(--text-primary);">${name}</td>
                </tr>
            `).join('');
            
            // Pastikan modal anggota tampil di atas login modal jika sedang terbuka
            modal.style.zIndex = 10002;
            modal.classList.add('show');
            // lock body scroll (handles Android touchmove prevention too)
            updateBodyLockState();
        }

        function closeMembersModal() {
            const modal = document.getElementById('membersModal');
            modal.classList.remove('show');
            modal.style.zIndex = '';
            // update lock state (will unlock if nothing else requires lock)
            updateBodyLockState();
            // Restore previous sidebar selection so the user doesn't see members as a selected section
            try {
                if (previousSidebarActive) {
                    document.querySelectorAll('.sidebar-nav-link').forEach(l => l.classList.remove('active'));
                    previousSidebarActive.classList.add('active');

                    if (previousSidebarActive.dataset.target === 'about') {
                        if (document.getElementById('section-all')) document.getElementById('section-all').style.display = 'none';
                        if (document.getElementById('section-about')) document.getElementById('section-about').style.display = 'block';
                    } else {
                        currentFilter = previousSidebarActive.dataset.filter || 'group';
                        if (document.getElementById('section-about')) document.getElementById('section-about').style.display = 'none';
                        if (document.getElementById('section-all')) document.getElementById('section-all').style.display = 'block';
                        // re-run search to update visible gallery based on restored filter
                        try { performSearch(document.getElementById('searchInput').value.trim()); } catch (e) { /* ignore */ }
                    }
                }
            } catch (e) {
                console.warn('Failed to restore previous sidebar selection', e);
            }
            previousSidebarActive = null;
        }

        // === NAVIGASI SIDEBAR ===
        document.querySelectorAll('.sidebar-nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();

                // Save previous active link so we can restore later (useful when opening members modal)
                const currentlyActive = document.querySelector('.sidebar-nav-link.active');
                previousSidebarActive = (currentlyActive && currentlyActive !== link) ? currentlyActive : null;

                // Update active class visually
                document.querySelectorAll('.sidebar-nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                if (link.dataset.target === 'about') {
                    document.getElementById('section-all').style.display = 'none';
                    document.getElementById('section-about').style.display = 'block';
                    return;
                }

                if (link.dataset.target === 'members') {
                    // Hide main sections because members content is shown in modal
                    document.getElementById('section-all').style.display = 'none';
                    document.getElementById('section-about').style.display = 'none';
                    openMembersModal();
                    return;
                }

                // Normal filter links
                currentFilter = link.dataset.filter || 'group';
                document.getElementById('section-about').style.display = 'none';
                document.getElementById('section-all').style.display = 'block';
                performSearch(document.getElementById('searchInput').value.trim());

                // On mobile, close the sidebar after selecting a menu item
                try {
                    if (window.innerWidth < 769) {
                        const sidebarEl = document.getElementById('sidebar');
                        if (sidebarEl && sidebarEl.classList.contains('active')) {
                            sidebarEl.classList.remove('active');
                            updateBodyLockState();
                        }
                    }
                } catch (e) { console.warn('Auto-close sidebar on mobile failed', e); }
            });
        });

        // === SEARCH ===
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                try {
                    // Hide scrolling photo bar when searching
                    const bar = document.getElementById('scrollingPhotoBar');
                    if (bar) bar.style.display = 'none';

                    performSearch(e.target.value.trim());
                } catch (err) {
                    console.error('Search error:', err);
                }
            });
        }

        // === CLEAR CACHE BUTTON ===
        document.addEventListener('DOMContentLoaded', () => {
            const clearCacheBtn = document.getElementById('clearCacheBtn');
            if (clearCacheBtn) {
                clearCacheBtn.addEventListener('click', () => {
                    if (confirm('Hapus semua cache? Halaman akan di-refresh.')) {
                        try {
                            localStorage.clear();
                            sessionStorage.clear();
                            if ('caches' in window) {
                                caches.keys().then(names => {
                                    names.forEach(name => caches.delete(name));
                                }).catch(e => console.log('Cache clear error:', e));
                            }
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } catch (e) {
                            console.error('Error clearing cache:', e);
                            alert('Gagal menghapus cache: ' + e.message);
                        }
                    }
                });
            }
        });

        // === SIDEBAR COLLAPSE ===
        const collapseBtn = document.getElementById('sidebarCollapse');
        if (collapseBtn) {
            collapseBtn.addEventListener('click', () => {
                const sidebar = document.getElementById('sidebar');
                const body = document.body;
                // On desktop (>=769px) we minimize the sidebar (collapse labels/icons)
                // On mobile, collapse button behaves like a mobile toggle (open/close)
                if (window.innerWidth >= 769) {
                    if (sidebar.classList.contains('collapsed')) {
                        sidebar.classList.remove('collapsed');
                        body.classList.remove('sidebar-collapsed');
                        collapseBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                    } else {
                        sidebar.classList.add('collapsed');
                        body.classList.add('sidebar-collapsed');
                        collapseBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                    }
                } else {
                    // mobile behavior: toggle active state (slide in/out)
                    sidebar.classList.toggle('active');
                    updateBodyLockState();
                }
            });
        }

        // === KEYBOARD SHORTCUTS ===
        document.addEventListener('keydown', (e) => {
            try {
                const key = e.key.toLowerCase();
                const modal = document.getElementById('imageModal');
                const isModalOpen = modal && modal.classList.contains('show');
                const shortcutsHint = document.getElementById('keyboardShortcutsHint');
                
                // ? atau / - Show/Hide Keyboard Shortcuts
                if (key === '?' || key === '/') {
                    if (shortcutsHint) {
                        shortcutsHint.classList.toggle('show');
                        e.preventDefault();
                    }
                }
                
                // ESC - Tutup modal
                if (e.key === 'Escape') {
                    if (isModalOpen) {
                        closeModal();
                        e.preventDefault();
                    } else if (shortcutsHint && shortcutsHint.classList.contains('show')) {
                        shortcutsHint.classList.remove('show');
                        e.preventDefault();
                    }
                }
                
                // NOTE: 'C' shortcut removed ‚Äî use 'M' to toggle menu on mobile
                
                // M atau m - Toggle menu (mobile)
                if (key === 'm') {
                    const toggleBtn = document.getElementById('sidebarToggle');
                    const sidebar = document.getElementById('sidebar');
                    if (toggleBtn && sidebar) {
                            sidebar.classList.toggle('active');
                            // update body lock so only sidebar can scroll on mobile
                            updateBodyLockState();
                            e.preventDefault();
                        }
                }
                
                // D atau d - Download (hanya jika modal terbuka)
                if (key === 'd' && isModalOpen) {
                    const videoEl = document.getElementById('modalVideo');
                    // Jika modal sedang menampilkan video, jangan trigger download
                    if (videoEl && videoEl.style.display !== 'none') {
                        e.preventDefault();
                    } else {
                        const downloadBtn = document.getElementById('downloadBtn');
                        if (downloadBtn) {
                            downloadBtn.click();
                            e.preventDefault();
                        }
                    }
                }
                
                // R atau r - Hapus cache
                if (key === 'r') {
                    if (confirm('Hapus semua cache? Halaman akan di-refresh.')) {
                        try {
                            localStorage.clear();
                            sessionStorage.clear();
                            if ('caches' in window) {
                                caches.keys().then(names => {
                                    names.forEach(name => caches.delete(name));
                                }).catch(e => console.log('Cache clear error:', e));
                            }
                            setTimeout(() => {
                                location.reload();
                            }, 500);
                        } catch (err) {
                            console.error('Error clearing cache:', err);
                            alert('Gagal menghapus cache: ' + err.message);
                        }
                    }
                    e.preventDefault();
                }
            } catch (err) {
                console.error('Keyboard shortcut error:', err);
            }
        });

        // === MOBILE TOGGLE ===
        const toggleBtn = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('active');
                // Ensure body locking state updates when sidebar opens/closes
                updateBodyLockState();
            });
        }

        // === BLOCKING PROTECTION ===
        // 1. Blokir RIGHT-CLICK (Desktop)
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });

        // 2. Blokir LONG-PRESS (Mobile) - detect touch-hold
        let touchStartTime = 0;
        const LONG_PRESS_DURATION = 500; // ms

        document.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
        }, false);

        document.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            if (touchDuration > LONG_PRESS_DURATION) {
                // Long press detected
                e.preventDefault();
            }
        }, false);

        // Prevent background touch-scroll on mobile when overlays/sidebars are open
        // Scroll lock configuration - can be customized at runtime
        const scrollLockConfig = {
            allowScrollSelectors: ['#sidebar', '.modal-dialog'], // selectors that should remain scrollable when locked
            lockOnModal: true,                  // lock body when image/member modal opens
            lockOnSidebar: true                 // lock body when sidebar is active
        };

        // Current touchmove handler reference so we can remove it reliably
        let _currentTouchMoveHandler = null;

        function _createTouchMoveHandler() {
            return function (ev) {
                try {
                    // If the touchstart / touchmove originated inside an allowed scrollable element, allow it
                    for (const sel of (scrollLockConfig.allowScrollSelectors || [])) {
                        if (!sel) continue;
                        const el = ev.target && ev.target.closest && ev.target.closest(sel);
                        if (el) return; // allow scrolling inside this element
                    }
                } catch (e) {
                    // ignore selector errors and fall back to blocking
                }
                ev.preventDefault();
            };
        }

        function lockBodyScroll() {
            try {
                document.body.style.overflow = 'hidden';
                if (_currentTouchMoveHandler) {
                    document.removeEventListener('touchmove', _currentTouchMoveHandler, { passive: false });
                }
                _currentTouchMoveHandler = _createTouchMoveHandler();
                document.addEventListener('touchmove', _currentTouchMoveHandler, { passive: false });
            } catch (e) { console.warn('lockBodyScroll failed', e); }
        }

        function unlockBodyScroll() {
            try {
                document.body.style.overflow = '';
                if (_currentTouchMoveHandler) {
                    document.removeEventListener('touchmove', _currentTouchMoveHandler, { passive: false });
                    _currentTouchMoveHandler = null;
                }
            } catch (e) { console.warn('unlockBodyScroll failed', e); }
        }

        function setScrollLockConfig(newConfig) {
            Object.assign(scrollLockConfig, newConfig || {});
            // when config changes, re-evaluate lock state
            updateBodyLockState();
        }

        function updateBodyLockState() {
            const sidebar = document.getElementById('sidebar');
            const imgModal = document.getElementById('imageModal');
            const membersModal = document.getElementById('membersModal');
            const sidebarActive = sidebar && sidebar.classList.contains('active');
            const modalOpen = (imgModal && imgModal.classList.contains('show')) || (membersModal && membersModal.classList.contains('show'));
            const shouldLock = (scrollLockConfig.lockOnModal && modalOpen) || (scrollLockConfig.lockOnSidebar && sidebarActive);
            if (shouldLock) {
                lockBodyScroll();
            } else {
                unlockBodyScroll();
            }
        }

        // 3. Blokir COPY (Ctrl+C / Cmd+C dan select text copy)
        document.addEventListener('copy', (e) => {
            e.preventDefault();
            return false;
        });

        // 4. Blokir SELECT TEXT (Ctrl+A dan drag select)
        document.addEventListener('selectstart', (e) => {
            // Izinkan select di input dan textarea
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                return false;
            }
        });

        // 5. Blokir CUT (Ctrl+X / Cmd+X)
        document.addEventListener('cut', (e) => {
            e.preventDefault();
            return false;
        });

        // 6. Blokir PASTE jika ada
        document.addEventListener('paste', (e) => {
            // Hanya blokir di luar input fields
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
            }
        });

        // 7. Blokir DRAG IMAGE (cegah drag gambar otomatis download)
        document.addEventListener('dragstart', (e) => {
            if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
                e.preventDefault();
            }
        });

        // === FAST MODE HANDLER ===
        function applyFastMode(enabled) {
            try {
                if (enabled) {
                    document.body.classList.add('fast-mode');
                    localStorage.setItem('fastMode', '1');
                } else {
                    document.body.classList.remove('fast-mode');
                    localStorage.removeItem('fastMode');
                }
            } catch (e) { console.warn('applyFastMode failed', e); }
        }

        function initFastModeToggle() {
            try {
                const toggle = document.getElementById('fastModeToggle');
                if (!toggle) return;
                // Initialize from localStorage
                const saved = localStorage.getItem('fastMode');
                const enabled = saved === '1' || saved === 'true';
                toggle.checked = !!enabled;
                applyFastMode(enabled);

                toggle.addEventListener('change', (e) => {
                    applyFastMode(!!e.target.checked);
                });
            } catch (e) { console.warn('initFastModeToggle error', e); }
        }

        // === SCROLLING PHOTO BAR TOGGLE HANDLER ===
        function applyScrollingPhotoBar(enabled) {
            try {
                const bar = document.getElementById('scrollingPhotoBar');
                if (!bar) return;

                if (enabled) {
                    localStorage.setItem('scrollingPhotoBarEnabled', '1');
                    // Show the bar if photos are available
                    initializeScrollingPhotoBar();
                } else {
                    localStorage.setItem('scrollingPhotoBarEnabled', '0');
                    bar.style.display = 'none';
                }
            } catch (e) { console.warn('applyScrollingPhotoBar failed', e); }
        }

        function initScrollingPhotoBarToggle() {
            try {
                const toggle = document.getElementById('scrollingPhotoBarToggle');
                if (!toggle) return;
                // Initialize from localStorage
                const saved = localStorage.getItem('scrollingPhotoBarEnabled');
                const enabled = saved !== '0'; // Default to enabled if not set
                toggle.checked = !!enabled;
                applyScrollingPhotoBar(enabled);

                toggle.addEventListener('change', (e) => {
                    applyScrollingPhotoBar(!!e.target.checked);
                });
            } catch (e) { console.warn('initScrollingPhotoBarToggle error', e); }
        }

        // Initialize fast-mode toggle after DOM ready
        try {
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(() => {
                    initFastModeToggle();
                    initScrollingPhotoBarToggle();
                }, 30);
            } else {
                document.addEventListener('DOMContentLoaded', () => {
                    initFastModeToggle();
                    initScrollingPhotoBarToggle();
                });
            }
        } catch (e) {
            console.warn('Initialization failed', e);
        }
    </script>
</body>
</html>
