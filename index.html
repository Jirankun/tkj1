<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="theme-color" content="#1e1e1e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="TKJ OnE">
<meta name="format-detection" content="telephone=no">
<title>Togetherness TKJ OnE</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Component styles (copies) -->
<link rel="stylesheet" href="components/sidebar/sidebar.css">
<link rel="stylesheet" href="components/bottombar/bottombar.css">
<link rel="stylesheet" href="components/login/login.css">
<style>
/* ===== MODERN ANDROID UI VARIABLES ===== */
:root {
--bg-primary: #121212;
--bg-secondary: #1e1e1e;
--bg-tertiary: #2d2d2d;
--text-primary: #ffffff;
--text-secondary: #b0b0b0;
--text-accent: #4caf50;
--accent-primary: #4caf50;
--accent-secondary: #2196f3;
--border-primary: #444444;
--glass-bg: rgba(255, 255, 255, 0.08);
--glass-border: rgba(255, 255, 255, 0.15);
--border-radius: 16px;
--border-radius-small: 12px;
--transition-smooth: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
--shadow-smooth: 0 4px 12px rgba(0, 0, 0, 0.3);
--shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.4);
--sidebar-width: 280px;
}
/* ===== BASE STYLES ===== */
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
-webkit-touch-callout: none;
}
body {
font-family: 'Roboto', 'Segoe UI', system-ui, sans-serif;
background: var(--bg-primary);
color: var(--text-primary);
line-height: 1.6;
position: relative;
overflow-x: hidden;
width: 100%;
height: 100vh;
display: flex;
flex-direction: column;
-webkit-font-smoothing: antialiased;
text-rendering: optimizeLegibility;
}
/* LOADING SCREEN */
.loading-screen {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: var(--bg-primary);
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
z-index: 9999;
backdrop-filter: blur(4px);
}
.loader {
width: 48px;
height: 48px;
border: 4px solid transparent;
border-top: 4px solid var(--accent-primary);
border-radius: 50%;
animation: spin 1s linear infinite;
margin-bottom: 1rem;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.loading-screen h1 {
font-size: 2rem;
font-weight: 700;
letter-spacing: -0.5px;
background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
-webkit-background-clip: text;
background-clip: text;
color: transparent;
margin: 0.5rem 0;
}
.loading-screen p {
color: var(--text-secondary);
font-size: 1.1rem;
font-weight: 400;
letter-spacing: 0.5px;
}
/* MODAL OVERLAY & CONTENT */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.85);
display: flex;
justify-content: center;
align-items: center;
z-index: 9998;
padding: 1.5rem;
backdrop-filter: blur(8px);
}
.modal-content {
background: var(--bg-secondary);
border-radius: var(--border-radius);
padding: 2rem 1.5rem;
width: 100%;
max-width: 420px;
box-shadow: var(--shadow-hover);
border: 1px solid var(--glass-border);
animation: modalPop 0.3s ease-out;
position: relative;
}
@keyframes modalPop {
0% { opacity: 0; transform: scale(0.95); }
100% { opacity: 1; transform: scale(1); }
}
.modal-content h2 {
color: var(--text-primary);
margin-bottom: 1.5rem;
text-align: center;
font-size: 1.3rem;
font-weight: 600;
display: flex;
align-items: center;
justify-content: center;
gap: 0.5rem;
}
.form-group {
margin-bottom: 1.5rem;
}
.input-field {
width: 100%;
padding: 1rem;
background: var(--bg-tertiary);
color: var(--text-primary);
border: 1px solid var(--border-primary);
border-radius: var(--border-radius-small);
font-size: 1rem;
outline: none;
transition: var(--transition-smooth);
font-weight: 500;
}
.input-field:focus {
border-color: var(--accent-primary);
box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}
.input-field::placeholder {
color: #aaa;
font-weight: 400;
}
.button-group {
display: flex;
gap: 1rem;
margin-bottom: 1.2rem;
}
.btn {
flex: 1;
padding: 0.85rem 1rem;
border: none;
border-radius: var(--border-radius-small);
font-weight: 600;
cursor: pointer;
transition: var(--transition-smooth);
font-size: 1rem;
display: inline-flex;
justify-content: center;
align-items: center;
text-decoration: none;
color: inherit;
position: relative;
overflow: hidden;
}
.btn::after {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(255,255,255,0.1);
opacity: 0;
transition: opacity 0.3s;
pointer-events: none;
}
.btn:active::after {
opacity: 1;
}
.btn-primary {
background: var(--accent-primary);
color: white;
}
.btn-primary:hover {
background: #43a047;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}
.btn-secondary {
background: var(--bg-tertiary);
color: var(--text-primary);
border: 1px solid var(--border-primary);
}
.btn-secondary:hover {
background: var(--glass-bg);
border-color: var(--accent-primary);
transform: translateY(-2px);
}
.error-message {
color: #ef5350;
text-align: center;
margin: 1.2rem 0;
min-height: 1.5rem;
font-size: 0.95rem;
font-weight: 500;
padding: 0.5rem;
border-radius: var(--border-radius-small);
background: rgba(239, 83, 80, 0.1);
border: 1px solid rgba(239, 83, 80, 0.3);
display: none;
}
.error-message.show {
display: block;
animation: shake 0.5s ease-in-out;
}
@keyframes shake {
0%, 100% { transform: translateX(0); }
25% { transform: translateX(-5px); }
75% { transform: translateX(5px); }
}
.hint-text {
text-align: center;
color: var(--text-secondary);
font-size: 0.9rem;
line-height: 1.5;
margin-top: 1rem;
padding: 0.8rem;
background: var(--glass-bg);
border-radius: var(--border-radius-small);
border: 1px solid var(--glass-border);
}
/* MAIN APP CONTAINER */
.main-app {
width: 100%;
height: 100%;
display: flex;
flex-direction: column;
flex: 1;
overflow: hidden;
}
/* SIDEBAR */
.sidebar-overlay {
position: fixed;
overflow: hidden;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.7);
backdrop-filter: blur(4px);
    /* Put overlay behind bottom nav (so bottom bar stays on top) and below the sidebar */
    z-index: 80;
display: none;
opacity: 0;
transition: var(--transition-smooth);
}
.sidebar-overlay.active {
display: block;
opacity: 1;
}
.sidebar {
position: fixed;
top: 0;
left: -100%;
width: var(--sidebar-width);
height: 100vh;
background: var(--bg-secondary);
border-right: 1px solid var(--glass-border);
padding: 1rem;
padding-top: 70px;
overflow: hidden;
    /* Keep the sidebar above the overlay but behind the bottom bar */
    z-index: 90;
transition: var(--transition-smooth);
overflow-y: auto;
-webkit-overflow-scrolling: touch;
}
.sidebar.active {
left: 0;
}
.sidebar-header {
margin-bottom: 2rem;
padding-bottom: 1rem;
border-bottom: 1px solid var(--glass-border);
}
.sidebar-header h3 {
font-size: 1.1rem;
font-weight: 600;
display: flex;
align-items: center;
gap: 0.5rem;
}
.sidebar-section {
margin-bottom: 1.5rem;
}
.sidebar-section h4 {
color: var(--text-secondary);
font-size: 0.85rem;
font-weight: 600;
text-transform: uppercase;
letter-spacing: 0.5px;
margin-bottom: 0.8rem;
}
.sidebar-menu-item {
display: flex;
align-items: center;
gap: 0.8rem;
padding: 0.75rem;
border-radius: var(--border-radius-small);
color: var(--text-secondary);
cursor: pointer;
transition: var(--transition-smooth);
font-weight: 500;
overflow: hidden;
}
.sidebar-menu-item:hover {
background: var(--glass-bg);
color: var(--text-primary);
}
.sidebar-menu-item.active {
background: var(--accent-primary);
color: white;
}
.sidebar-menu-item i {
width: 20px;
text-align: center;
font-size: 1rem;
}
/* HEADER */
.header {
background: rgba(30, 30, 30, 0.95);
backdrop-filter: blur(10px);
padding: 1rem;
display: flex;
align-items: center;
gap: 1rem;
flex-shrink: 0;
z-index: 10;
box-shadow: var(--shadow-smooth);
position: sticky;
top: 0;
}
.menu-btn {
background: var(--accent-primary);
color: white;
border: none;
width: 44px;
height: 44px;
border-radius: 12px;
cursor: pointer;
font-size: 1.1rem;
display: flex;
align-items: center;
justify-content: center;
transition: var(--transition-smooth);
flex-shrink: 0;
}
.menu-btn:hover {
background: #43a047;
transform: scale(1.05);
}
.app-title {
font-size: 1.2rem;
font-weight: 700;
letter-spacing: -0.5px;
flex: 1;
text-align: center;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
/* Style for the sidebar 'Daftar' (open members) button to be visually wider */
.open-members-btn {
    display: block;
    width: calc(100% - 0.5rem);
    margin: 1rem 0 0 0;
    padding: 0.9rem 0.9rem;
    font-size: 1rem;
    border-radius: 12px;
    text-align: center;
}
/* BOTTOM NAVIGATION */
.bottom-nav {
position: fixed;
bottom: env(safe-area-inset-bottom, 0);
left: 0;
width: 100%;
background: var(--bg-secondary);
display: flex;
justify-content: space-around;
padding: env(safe-area-inset-bottom, 8px) 0 8px;
box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.2);
z-index: 100;
backdrop-filter: blur(10px);
border-top: 1px solid var(--glass-border);
}
.nav-item {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
color: var(--text-secondary);
text-decoration: none;
padding: 0.75rem 0.5rem;
border-radius: var(--border-radius-small);
transition: var(--transition-smooth);
min-width: 70px;
position: relative;
}
.nav-item.active {
color: var(--accent-primary);
}
.nav-item.active::after {
content: '';
position: absolute;
bottom: 0;
width: 60%;
height: 3px;
background: var(--accent-primary);
border-radius: 3px;
}
.nav-item i {
font-size: 1.3rem;
margin-bottom: 0.3rem;
transition: var(--transition-smooth);
}
.nav-item.active i,
.nav-item:active i {
transform: scale(1.1);
}
.nav-item span {
font-size: 0.75rem;
font-weight: 600;
letter-spacing: 0.3px;
}
/* CONTENT */
.content-wrapper {
display: flex;
flex: 1;
overflow: hidden;
}
.content {
flex: 1;
overflow-y: auto;
-webkit-overflow-scrolling: touch;
padding: 0;
padding-bottom: calc(70px + env(safe-area-inset-bottom, 0));
margin-top: 0;
scroll-padding-top: 60px;
    /* Use full width by default; reserve space only when sidebar is active */
    width: 100%;
    margin-left: 0;
transition: var(--transition-smooth);
}
.content.shifted {
    /* When shifted (sidebar open) reduce width and apply left margin */
    margin-left: var(--sidebar-width);
    width: calc(100% - var(--sidebar-width));
}
.section-content {
padding: 1.5rem;
animation: fadeInUp 0.3s ease-out;
}
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}
/* Gaya untuk popup status update - POSISI DIPERBAIKAN */
.update-popup {
position: fixed; /* Ganti dari sticky ke fixed */
top: 0; /* Langsung ke atas */
left: 50%; /* Tengahkan secara horizontal */
transform: translateX(-50%); /* Geser ke kiri setengah lebarnya sendiri */
width: fit-content;
max-width: 90vw; /* Maksimal 90% lebar layar */
margin: 0 auto; /* Tengahkan lagi sebagai fallback */
padding: 8px 16px;
background-color: #333;
color: white;
border-radius: 20px;
box-shadow: 0 2px 10px rgba(0,0,0,0.3);
z-index: 10000; /* Z-index sangat tinggi untuk selalu di atas */
font-size: 0.9em;
text-align: center;
opacity: 0; /* Sembunyikan secara default */
animation: slideDownAppear 0.3s ease-out forwards; /* Animasi muncul */
}
/* Animasi untuk muncul (slide down) */
@keyframes slideDownAppear {
from { top: -50px; opacity: 0; } /* Mulai dari atas */
to { top: 0; opacity: 1; } /* Berakhir di posisi atas */
}
/* Animasi naik-turun sekali */
.animate-bounce-once {
animation: bounceOnce 0.8s ease-in-out;
}
@keyframes bounceOnce {
0% { transform: translateX(-50%) translateY(0); }
50% { transform: translateX(-50%) translateY(-5px); }
100% { transform: translateX(-50%) translateY(0); }
}
/* Animasi untuk menghilang (slide up) */
.animate-slide-up {
animation: slideUpDisappear 0.5s ease-in forwards;
}
@keyframes slideUpDisappear {
from { top: 0; opacity: 1; }
to { top: -50px; opacity: 0; }
}
/* Container untuk tombol download */
.download-button-container {
margin-top: 8px; /* Jarak antara pesan dan tombol */
display: none; /* Sembunyikan secara default */
}
/* Gaya tombol download */
.download-button {
background-color: #4CAF50; /* Hijau */
color: white;
border: none;
border-radius: 15px;
padding: 6px 12px;
font-size: 0.85em;
cursor: pointer;
transition: background-color 0.3s;
}
.download-button:hover {
background-color: #45a049; /* Warna hover hijau */
}
.download-button:active {
transform: scale(0.98); /* Efek tekan */
}
/* SECURITY NOTICE */
.security-notice {
background: var(--bg-tertiary);
border-radius: var(--border-radius);
padding: 1.5rem;
margin: 1.5rem;
text-align: center;
border-left: 5px solid var(--accent-primary);
animation: pulse 2s infinite;
}
@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.9; }
}
.security-notice h3 {
color: var(--text-primary);
margin-bottom: 0.8rem;
font-size: 1.1rem;
font-weight: 600;
display: flex;
align-items: center;
justify-content: center;
gap: 0.5rem;
}
.security-notice p {
color: var(--text-secondary);
margin-bottom: 1.2rem;
font-size: 0.95rem;
line-height: 1.6;
}
/* GALLERY */
.search-box-container {
position: sticky;
top: 0;
background: var(--bg-primary);
padding: 1rem;
z-index: 5;
backdrop-filter: blur(10px);
border-bottom: 1px solid var(--glass-border);
}
.search-box {
width: 100%;
padding: 0.85rem 1rem;
background: var(--bg-tertiary);
color: var(--text-primary);
border: 1px solid var(--border-primary);
border-radius: var(--border-radius);
font-size: 1rem;
outline: none;
transition: var(--transition-smooth);
font-weight: 500;
}
.search-box:focus {
border-color: var(--accent-primary);
box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}
.search-box::placeholder {
color: #aaa;
}
.gallery-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
gap: 1rem;
padding: 1rem;
}
.gallery-item {
background: var(--bg-tertiary);
border-radius: var(--border-radius);
overflow: hidden;
cursor: pointer;
transition: var(--transition-smooth);
position: relative;
aspect-ratio: 1 / 1.2;
display: flex;
flex-direction: column;
}
.gallery-item:hover {
transform: translateY(-4px);
box-shadow: var(--shadow-hover);
}
.gallery-item:active {
transform: scale(0.97);
}
.gallery-item img,
.gallery-item video {
width: 100%;
height: 0;
flex: 1;
object-fit: cover;
display: block;
background: linear-gradient(45deg, #2a2a2a, #3a3a3a);
}
.gallery-item-name {
    /* moved into meta overlay (positioned at top of photo) */
    padding: 6px 8px;
    font-size: 0.95rem;
    text-align: left;
    color: var(--text-primary);
    font-weight: 700;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.gallery-item-date {
    padding: 4px 8px;
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-align: left;
    background: rgba(0,0,0,0.35);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.gallery-item-meta {
    position: absolute;
    top: 8px;
    left: 8px;
    right: 8px;
    /* Keep meta above the image but below header/search and bottom nav
       Header z-index: 10, search z-index: 5, bottom-nav z-index: 100
       Use 4 so it won't appear in front of header/search/bottom-nav. */
    z-index: 4;
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.gallery-item .loader {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
z-index: 999;
width: 20px;
height: 20px;
border: 3px solid transparent;
border-top: 3px solid var(--accent-primary);
border-radius: 50%;
animation: spin 1s linear infinite;
}
/* PROFILE & INFO CARDS */
.profile-card, .info-card {
background: var(--bg-secondary);
border-radius: var(--border-radius);
padding: 1.5rem;
margin-top: 1rem;
border: 1px solid var(--glass-border);
box-shadow: var(--shadow-smooth);
}
.profile-info p {
margin: 0.8rem 0;
color: var(--text-secondary);
font-size: 1rem;
display: flex;
align-items: center;
gap: 0.5rem;
}
.profile-info strong {
color: var(--accent-primary);
min-width: 80px;
}
.info-card h3 {
color: var(--text-primary);
margin-bottom: 1rem;
font-size: 1.1rem;
font-weight: 600;
}
.info-card p {
color: var(--text-secondary);
line-height: 1.7;
margin-bottom: 1rem;
font-size: 0.95rem;
}
/* IMAGE MODAL */
.image-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.95);
display: none;
justify-content: center;
align-items: center;
    /* Ensure sidebar sits above overlay and other UI elements */
    z-index: 130;
    z-index: 10050;
padding: 1rem;
backdrop-filter: blur(4px);
}
.image-modal.active {
display: flex;
animation: fadeIn 0.2s ease-out;
}
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}
.modal-container {
background: var(--bg-secondary);
border-radius: var(--border-radius);
padding: 1.5rem;
width: 100%;
max-width: 95vw;
max-height: 95vh;
position: relative;
display: flex;
flex-direction: column;
align-items: center;
box-shadow: var(--shadow-hover);
border: 1px solid var(--glass-border);
animation: modalScale 0.3s ease-out;
    z-index: 10051; /* ensure content and controls are above overlay */
}
@keyframes modalScale {
0% { transform: scale(0.9); opacity: 0; }
100% { transform: scale(1); opacity: 1; }
}
.close-btn {
position: absolute;
top: 15px;
right: 15px;
background: var(--accent-secondary);
color: white;
border: none;
width: 40px;
height: 40px;
border-radius: 50%;
font-size: 1.3rem;
cursor: pointer;
z-index: 10;
display: flex;
align-items: center;
justify-content: center;
transition: var(--transition-smooth);
}
.close-btn:hover {
background: #1976d2;
transform: rotate(90deg);
}
.image-wrapper {
width: 100%;
margin-bottom: 1.2rem;
display: flex;
justify-content: center;
align-items: center;
flex: 1;
min-height: 200px;
}
.image-wrapper img,
.image-wrapper video {
max-width: 100%;
max-height: 70vh;
object-fit: contain;
border-radius: var(--border-radius-small);
background: #000;
box-shadow: 0 4px 16px rgba(0,0,0,0.5);
}
.image-info {
text-align: center;
width: 100%;
}
.image-info p {
color: var(--text-secondary);
margin: 0.5rem 0;
font-size: 0.95rem;
}
#imageName {
color: var(--text-primary);
font-size: 1.1rem;
font-weight: 600;
word-break: break-word;
}
#downloadBtn {
margin-top: 1.2rem;
width: 100%;
padding: 0.9rem;
font-size: 1rem;
font-weight: 600;
}
/* CUSTOM CONTEXT MENU */
.context-menu {
position: fixed; /* Selalu posisi fixed */
background: var(--bg-secondary);
border-radius: var(--border-radius);
padding: 0.5rem 0;
box-shadow: var(--shadow-hover);
z-index: 3000;
min-width: 160px;
display: none;
max-width: 200px;
border: 1px solid var(--glass-border);
backdrop-filter: blur(10px);
animation: contextSlide 0.2s ease-out;
}
@keyframes contextSlide {
0% { opacity: 0; transform: scale(0.95); }
100% { opacity: 1; transform: scale(1); }
}
.context-menu.show {
display: block;
}
.context-menu-item {
padding: 0.75rem 1.2rem;
color: var(--text-secondary);
cursor: pointer;
transition: var(--transition-smooth);
display: flex;
align-items: center;
gap: 0.7rem;
font-weight: 500;
}
.context-menu-item:hover {
background: var(--glass-bg);
color: var(--text-primary);
padding-left: 1.4rem;
}
.context-menu-item i {
width: 18px;
text-align: center;
font-size: 1rem;
color: var(--accent-primary);
}
/* Overlay saat context menu muncul */
body.context-active::before {
content: '';
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: #00000066; /* Warna gelap dengan opacity */
z-index: 2999; /* Di bawah context menu tapi di atas semua elemen lain */
pointer-events: auto; /* Capture clicks so underlying elements are not accidentally activated */
}
/* RESPONSIVE */
@media (max-width: 768px) {
:root {
--sidebar-width: 260px;
}
.gallery-grid {
grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
gap: 0.75rem;
padding: 0.75rem;
}
.header {
padding: 0.8rem 1rem;
}
.app-title {
font-size: 1.1rem;
}
.content {
padding-bottom: calc(65px + env(safe-area-inset-bottom, 0));
width: 100%;
}
.content.shifted {
width: 100%;
}
.modal-content {
padding: 1.5rem 1rem;
}
.nav-item {
min-width: 60px;
padding: 0.6rem 0.3rem;
}
.nav-item i {
font-size: 1.1rem;
}
.nav-item span {
font-size: 0.7rem;
}
.search-box-container {
padding: 0.75rem;
}
.search-box {
padding: 0.75rem;
font-size: 0.95rem;
}
}
/* Prevent drag & selection */
img, video {
    /* Prevent dragging of media across most browsers */
    -webkit-user-drag: none; /* Safari/Chrome */
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none; /* non-standard, best-effort */
    /* Prevent selection and touch-based drags */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
.gallery-item img,
.gallery-item video {
pointer-events: none;
}

/* LIST VIEW STYLES */
.photo-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 8px 6px;
}
.photo-list .list-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px;
    border-radius: 10px;
    background: var(--bg-secondary);
    border: 1px solid var(--glass-border);
    cursor: pointer;
}
.photo-list .list-item img {
    width: 84px;
    height: 84px;
    object-fit: cover;
    border-radius: 8px;
    flex-shrink: 0;
}
.photo-list .list-item .info {
    flex: 1;
    min-width: 0;
}
.photo-list .list-item .info .name {
    font-weight: 700;
    color: var(--text-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.photo-list .list-item .info .date {
    color: var(--text-secondary);
    font-size: 0.9rem;
}
.photo-list .list-item .actions .btn { padding: 6px 10px; }
.photo-list .list-item .actions .btn { padding: 6px 8px; border-radius:8px; background: transparent; border: 1px solid rgba(255,255,255,0.03); color:var(--text-secondary); min-width:40px }
.photo-list .list-item .actions .btn i { font-size:1rem }
</style>
</head>
<body>
<!-- LOADING SCREEN -->
<div id="loadingScreen" class="loading-screen">
<div class="loader"></div>
<h1>TKJ OnE</h1>
<p>Togetherness</p>
</div>
<!-- Popup Update Status - DIPINDAHKAN SEBELUM MODAL LOGIN -->
<div class="update-popup" id="updatePopup">
<span id="popupMessage">Memeriksa update...</span>
<div class="download-button-container" id="downloadButtonContainer">
<button class="download-button" id="downloadButton">Unduh</button>
</div>
</div>
<!-- LOGIN MODAL -->
<div id="loginModal" class="modal-overlay">
<div class="modal-content">
<h2><i class="fas fa-lock"></i> Masuk ke Album</h2>
<div class="form-group">
<input type="text" id="accessCode" placeholder="Masukkan kode akses" class="input-field" autocomplete="off">
</div>
<div class="button-group">
<button onclick="pasteCode()" class="btn btn-secondary"><i class="fas fa-paste"></i> Tempel</button>
<button onclick="verifyCode()" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Masuk</button>
</div>
    <button id="openMembersBtn" class="btn btn-secondary open-members-btn" aria-label="Daftar" type="button">
        <i class="fas fa-user"></i> Minta kode
    </button>
<div id="errorMsg" class="error-message"></div>
<div class="hint-text">
Gunakan kode akses untuk login. Jika kamu membagikan Kode akses,sama halnya seperti kamu membagikan akun Email kamu sendiri.
</div>
</div>
</div>
<!-- MAIN APP -->
<div id="mainApp" class="main-app" style="display:none;">
<!-- SIDEBAR -->
<div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleMenu()"></div>
<div id="sidebar" class="sidebar">
<div class="sidebar-header">
<h3><i class="fas fa-filter"></i> Filter Konten</h3>
</div>
<div class="sidebar-section">
<h4>Gender</h4>
<div class="sidebar-menu-item active" data-filter="all" onclick="setFilter('all')">
<i class="fas fa-users"></i>
<span>Semua</span>
</div>
<div class="sidebar-menu-item" data-filter="group" onclick="setFilter('group')">
<i class="fas fa-users"></i>
<span>Group</span>
</div>
<div class="sidebar-menu-item" data-filter="male" onclick="setFilter('male')">
<i class="fas fa-mars"></i>
<span>Pria</span>
</div>
<div class="sidebar-menu-item" data-filter="female" onclick="setFilter('female')">
<i class="fas fa-venus"></i>
<span>Wanita</span>
</div>
</div>
    <div class="sidebar-section">
    <h4>Jenis Media</h4>
    <div class="sidebar-menu-item active" data-media="all" onclick="setMediaFilter('all')">
    <i class="fas fa-layer-group"></i>
    <span>Semua Media</span>
    </div>
    <div class="sidebar-menu-item" data-media="photo" onclick="setMediaFilter('photo')">
    <i class="fas fa-image"></i>
    <span>Foto</span>
    </div>
    <div class="sidebar-menu-item" data-media="video" onclick="setMediaFilter('video')">
    <i class="fas fa-video"></i>
    <span>Video</span>
    </div>
    </div>
    <div class="sidebar-section">
    <h4>Gaya</h4>
    <div class="sidebar-menu-item active" data-view="grid" onclick="setViewMode('grid', this)">
    <i class="fas fa-th-large"></i>
    <span>Grid</span>
    </div>
    <div class="sidebar-menu-item" data-view="list" onclick="setViewMode('list', this)">
    <i class="fas fa-list"></i>
    <span>Daftar</span>
    </div>
    </div>
      <p class="app-title">
         <a href="https://github.com/Jirankun/TKJ-One/releases/" >Unduh aplikasi TKJ-OnE
        </a>
      </p>
</div>
<!-- HEADER -->
<header class="header">
<button id="menuBtn" class="menu-btn" onclick="toggleMenu()">
<i class="fas fa-bars"></i>
</button>
<h1 class="app-title"></h1>
</header>
<!-- CONTENT WRAPPER -->
<div class="content-wrapper">
<!-- CONTENT -->
<main class="content" id="mainContent">
<!-- SECURITY NOTICE -->
<div id="securityNotice" class="security-notice" style="display:none;">
<h3><i class="fas fa-shield-alt"></i> Keamanan Konten</h3>
<p>Dilarang mengambil screenshot pada Halaman web ini,mohon di Unduh gambar jika kamu ingin membagikan.</p>
<button onclick="acceptSecurity()" class="btn btn-primary" style="width:140px;margin:0 auto;">
<i class="fas fa-check"></i> Saya Mengerti
</button>
</div>
<!-- GALLERY SECTION -->
<div id="gallerySection" style="display:none;">
<div class="search-box-container">
<input type="number" id="searchInput" class="search-box" placeholder="Cari foto sesuai nomor foto atau tanggal..." onkeyup="performSearch()">
</div>
<div id="galleryContainer" class="gallery-grid"></div>
</div>
<!-- PROFILE SECTION -->
<div id="profileSection" style="display:none;" class="section-content">
<h2><i class="fas fa-user-circle"></i> Profil Pengguna</h2>
<div class="profile-card">
<div class="profile-info">
<p><strong>Nama:</strong> <span id="profileName">-</span></p>
<p><strong>Kode:</strong> <span id="profileCode">-</span></p>
<p><strong>Hitungan Mengunduh:</strong> <span id="profileDownloads">0</span>Kali Mengunduh</p>
</div>
</div>
</div>
<!-- INFO SECTION -->
<div id="infoSection" style="display:none;" class="section-content">
<h2><i class="fas fa-info-circle"></i> Info Developer</h2>
<div class="info-card">
<h3>ZHYLLAN FYLLAH</h3>
<p>Website ini dibuat sebagai memori atas kebersamaan kelas TKJ 1 SMK N 1 LEMBAH MELINTANG.</p>
<p>Terima kasih kepada semua teman-teman yang telah berkontribusi dalam pengambilan foto dan video untuk pengisian konten pada halaman web ini,semoga sehat Selalu dan di berkati tuhan.</p>
</div>
</div>
</main>
</div>
<!-- BOTTOM NAVIGATION -->
<div class="bottom-nav">
<a href="#" class="nav-item active" onclick="showGallery(); return false;">
<i class="fas fa-images"></i>
<span>Galeri</span>
</a>
<a href="#" class="nav-item" onclick="openProfile(event); return false;">
<i class="fas fa-user"></i>
<span>Profil</span>
</a>
<a href="#" class="nav-item" onclick="openInfo(event); return false;">
<i class="fas fa-info-circle"></i>
<span>Info</span>
</a>
<a href="#" class="nav-item" onclick="logout(event); return false;">
<i class="fas fa-sign-out-alt"></i>
<span>Logout</span>
</a>
</div>
<!-- CUSTOM CONTEXT MENU -->
<div id="customContextMenu" class="context-menu">
    <div class="context-menu-item" onclick="previewContextItem()"><i class="fas fa-eye"></i> Pratinjau</div>
    <div class="context-menu-item" onclick="downloadContextItem()"><i class="fas fa-download"></i> Unduh</div>
    <div class="context-menu-item" onclick="shareContextItem()"><i class="fas fa-share-alt"></i> Bagikan</div>
    <div class="context-menu-item" onclick="reportImage()"><i class="fas fa-exclamation-triangle"></i> Laporkan Foto</div>
</div>
</div>
<!-- IMAGE MODAL -->
<div id="imageModal" class="image-modal" onclick="closeModal()">
<div class="modal-container" onclick="event.stopPropagation()">
<button class="close-btn" onclick="closeModal()">&times;</button>
<div class="image-wrapper">
<img id="modalImage" src="" alt="Gallery Image" draggable="false">
<video id="modalVideo" controls style="display:none;" draggable="false"></video>
</div>
<div class="image-info">
<p><strong id="imageName">-</strong></p>
<p id="imageDate" style="color:#999;font-size:0.85rem;"></p>
    <div style="display:flex;gap:8px;margin-top:10px;">
    <button id="downloadBtn" onclick="downloadImage(null)" class="btn btn-primary">
        <i class="fas fa-download"></i> Unduh
    </button>
</div>
</div>
<!-- PREVIEW MODAL (included fragment) -->
<!-- Inserted preview modal HTML (kept separate for clarity) -->
        <div id="previewModal" class="modal-overlay" style="display:none;" onclick="closePreviewModal()">
    <div class="modal-content" style="max-width:820px; width: calc(100% - 48px);">
        <h2><i class="fas fa-list"></i> Daftar Foto</h2>
        <div id="previewList" style="max-height:60vh;overflow:auto;padding-right:4px;margin-top:0.5rem;"></div>
        <div style="text-align:center;margin-top:1rem;">
            <button class="btn btn-secondary" onclick="closePreviewModal()">Tutup</button>
        </div>
    </div>
</div>
</div>
</div>
<script>
// Konfigurasi
const CURRENT_APP_VERSION = 'v100000'; // Ganti dengan versi aplikasi Anda
const GITHUB_REPO_OWNER = 'Jirankun';  // Ganti dengan owner repo Anda
const GITHUB_REPO_NAME = 'TKJ-One';   // Ganti dengan nama repo Anda
const GITHUB_RELEASE_URL = `https://github.com/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/releases/latest`;
// Elemen DOM
const popup = document.getElementById('updatePopup');
const messageElement = document.getElementById('popupMessage');
const buttonContainer = document.getElementById('downloadButtonContainer');
const downloadButton = document.getElementById('downloadButton');
// Fungsi untuk mengatur pesan, tombol, dan memicu animasi
function showPopup(message, showButton = false, bounceOnce = false, autoHide = false, hideOnFail = false) {
    messageElement.textContent = message;
    messageElement.innerHTML = message; // Gunakan innerHTML untuk mendukung <br>
    buttonContainer.style.display = showButton ? 'block' : 'none';

    // Hapus kelas animasi sebelumnya
    popup.classList.remove('animate-bounce-once', 'animate-slide-up');
    popup.style.animation = 'none'; // Reset animasi untuk restart
    void popup.offsetWidth; // Trigger reflow
    popup.style.animation = null;

    if (bounceOnce) {
        popup.classList.add('animate-bounce-once');
    } else {
        popup.classList.remove('animate-bounce-once');
    }

    // Jika autoHide true, sembunyikan setelah delay
    if (autoHide) {
        setTimeout(() => {
            popup.classList.add('animate-slide-up');
        }, 3000); // 3 detik setelah animasi bounce selesai
    }
    // Jika hideOnFail true, sembunyikan setelah bounce sekali
    if (hideOnFail) {
        setTimeout(() => {
            popup.classList.add('animate-slide-up');
        }, 800); // ~Durasi animasi bounceOnce
    }
    // Popup sudah terlihat karena animasi muncul
    popup.style.opacity = '1';
}
// Fungsi untuk menyembunyikan popup secara langsung (jika diperlukan)
function hidePopup() {
    popup.classList.add('animate-slide-up');
}
// Fungsi untuk memeriksa update
async function checkForUpdates() {
    showPopup("Memeriksa update...", false, true, false, false); // Tampilkan pesan dan animasi bounce sekali

    try {
        const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO_OWNER}/${GITHUB_REPO_NAME}/releases`);
        if (!response.ok) {
            throw new Error(`GitHub API error: ${response.status}`);
        }
        const releases = await response.json();

        if (releases.length === 0) {
            showPopup("Tidak ada rilis ditemukan.", false, true, true, false); // Bounce sekali, lalu hilang otomatis
            return;
        }

        const latestRelease = releases[0];
        const latestVersion = latestRelease.tag_name;
        const releaseName = latestRelease.name || latestVersion; // Gunakan nama release, jika tidak ada gunakan tag

        // Normalize and compare versions (strip leading 'v' and compare numeric segments)
        const normalize = v => String(v || '').trim().replace(/^v/i, '');
        const compareSemver = (a, b) => {
            if (!a && !b) return 0;
            const pa = normalize(a).split(/[^0-9]+/).filter(Boolean).map(n => parseInt(n, 10));
            const pb = normalize(b).split(/[^0-9]+/).filter(Boolean).map(n => parseInt(n, 10));
            const len = Math.max(pa.length, pb.length);
            for (let i = 0; i < len; i++) {
                const na = pa[i] || 0;
                const nb = pb[i] || 0;
                if (na > nb) return 1;
                if (na < nb) return -1;
            }
            return 0;
        };

        const cmp = compareSemver(latestVersion, CURRENT_APP_VERSION);

        // Only show update notification when latest release is newer
        if (cmp > 0) {
            console.log(`Update ditemukan: ${latestVersion}`, releaseName);
            downloadButton.onclick = () => {
                window.open(latestRelease.html_url || GITHUB_RELEASE_URL, '_blank');
                // Opsional: Sembunyikan setelah klik
                // hidePopup();
            };
            // Format pesan menjadi dua baris
            const fullMessage = `Update tersedia!<br>${releaseName}`;
            // Tampilkan pesan dengan format HTML
            showPopup(fullMessage, true, false, false, false);
        } else {
            // Current version is up-to-date: show a brief confirmation popup
            console.log("Aplikasi sudah versi terbaru.");
            showPopup("Kamu sedang menjalankan versi web, Unduh aplikasi untuk pengalaman terbaik", false, true, true, false);
        }
    } catch (error) {
        console.error("Error saat memeriksa update:", error);
        showPopup("Memeriksa update gagal", false, true, false, true); // Bounce sekali, lalu hilang ke atas
    }
}
// Jalankan pemeriksaan saat halaman dimuat
document.addEventListener('DOMContentLoaded', checkForUpdates);
// ===== ALLOWED USERS (DAFTAR NAMA ANGGOTA) =====
const ALLOWED_NAMES = [
"Abiyu Anugrah", "Aktsar Hakim Nst", "Amalia Safitri", "Amir Hamzah",
"Asra Bilhuda", "Eli Zahara", "Ezyla Aziz Zeira", "Fadel Muhammad Rezki",
"Faizul Adzimi", "Faldho Adzani", "Fitria Mulia", "Galang Luqmanul Hakim",
"Hafif Mabrur", "Kasifa Rahmah", "Keysa Putri Ramadani", "M. Rafiki Rasli",
"Muhammad Hibban Aulia", "Muhammad Yudha Pratama", "Najia Atika Sahira",
"Najwa Asyifa", "Rafi Idham", "Ranti Amelia", "Rasima Handayani",
"Reviansyah", "Reza Ardiansyah", "Sakinah Khanza", "Salimah", "Salsa Bila",
"Susi Saskia", "Syah Ratul Paiza", "Thalita Syafa Harahap", "Tonius Nduru",
"Yennisa Mulia", "Yuda Setriawan", "Zhyllan Fyllah"
];
// ===== ENCRYPTION FUNCTIONS =====
function hashPass(pass) {
let h = 0;
for (let c of pass) h = Math.imul(h ^ c.charCodeAt(), 1540483477) >>> 0;
return h;
}
const CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
function codeToText(code, pass) {
let clean = code.replace(/-/g, '');
if (clean.length % 2 !== 0) throw new Error("Kode rusak");
const seed = hashPass(pass);
let out = '';
for (let i = 0; i < clean.length; i += 2) {
const a = CHARS.indexOf(clean[i]);
const b = CHARS.indexOf(clean[i + 1]);
if (a === -1 || b === -1) throw new Error("Karakter tidak valid");
const val = a * CHARS.length + b;
const offset = (seed + (i / 2) * 41) % CHARS.length;
const orig = (val - offset + 256) % 256;
out += String.fromCharCode(orig);
}
return out;
}
// ===== STATE MANAGEMENT =====
let currentUser = null;
// Default to 'all' so the "Semua" filter truly shows everything on load
let currentFilter = 'all';
let currentMediaFilter = 'all';
// View mode: 'grid' or 'list' (default grid)
let currentViewMode = 'grid';
let allPhotos = [];
let currentPhoto = null;
let selectedPhotoForReport = null;
let longPressTimer = null;
let sidebarActive = false;
// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', () => {
const storedUser = localStorage.getItem('logged_in_user');
if (storedUser) {
currentUser = storedUser;
showMainApp();
} else {
hideLoadingScreen();
}
});

// Network status handlers: notify user on offline/online and optionally reload DB when reconnected
window.addEventListener('offline', () => {
    showPopup('Internet tidak tersedia', false, true, false, true);
});
window.addEventListener('online', () => {
    showPopup('Koneksi internet tersedia', false, true, true, false);
    // Try to reload photos when connection is restored
    setTimeout(() => {
        if (document.getElementById('gallerySection').style.display === 'block') loadPhotos();
    }, 600);
});
// ===== LOGIN FUNCTIONS =====
function pasteCode() {
const input = document.getElementById('accessCode');
const errorMsg = document.getElementById('errorMsg');
if (navigator.clipboard && navigator.clipboard.readText) {
navigator.clipboard.readText().then(text => {
if (text) {
input.value = text.trim();
errorMsg.textContent = '✓ Kode berhasil ditempel!';
errorMsg.classList.add('show');
setTimeout(() => {
errorMsg.classList.remove('show');
errorMsg.textContent = '';
}, 2000);
}
}).catch(() => {
const manual = prompt('Tempelkan kode akses:');
if (manual) input.value = manual;
});
} else {
const manual = prompt('Tempelkan kode akses:');
if (manual) input.value = manual;
}
}
function verifyCode() {
const code = document.getElementById('accessCode').value.trim();
const errorMsg = document.getElementById('errorMsg');
if (!code) {
errorMsg.textContent = '⚠️ Masukkan kode terlebih dahulu!';
errorMsg.classList.add('show');
return;
}
try {
const SHARED_SECRET = "tkjone";
const name = codeToText(code, SHARED_SECRET);
if (ALLOWED_NAMES.includes(name)) {
currentUser = name;
localStorage.setItem('logged_in_user', name);
localStorage.setItem('user_code', code);
showMainApp();
} else {
errorMsg.textContent = '❌ Nama tidak dikenali';
errorMsg.classList.add('show');
}
} catch (e) {
errorMsg.textContent = '❌ Kode tidak valid';
errorMsg.classList.add('show');
}
}
function hideLoadingScreen() {
document.getElementById('loadingScreen').style.display = 'none';
document.getElementById('loginModal').style.display = 'flex';
}
// ===== SIDEBAR FUNCTIONS =====
function toggleMenu() {
// Hanya izinkan sidebar di halaman galeri
if (document.getElementById('gallerySection').style.display !== 'block') {
return;
}
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('sidebarOverlay');
const content = document.querySelector('.content');
sidebarActive = !sidebarActive;
if (sidebarActive) {
sidebar.classList.add('active');
    // Position overlay so it does not cover the sidebar itself (blur should affect only content)
    const sidebarWidth = sidebar.offsetWidth || parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width')) || 280;
    overlay.style.left = sidebarWidth + 'px';
    overlay.style.right = '0';
    overlay.style.width = `calc(100% - ${sidebarWidth}px)`;
    overlay.classList.add('active');
content.classList.add('shifted');
} else {
sidebar.classList.remove('active');
    overlay.classList.remove('active');
    // Reset overlay positioning so it covers the whole screen when closed
    overlay.style.left = '';
    overlay.style.right = '';
    overlay.style.width = '';
content.classList.remove('shifted');
}
}
function setFilter(filter) {
currentFilter = filter;
// Update active state
document.querySelectorAll('[data-filter]').forEach(item => {
item.classList.remove('active');
});
document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
renderGallery();
}
function setMediaFilter(media) {
currentMediaFilter = media;
// Update active state
document.querySelectorAll('[data-media]').forEach(item => {
item.classList.remove('active');
});
document.querySelector(`[data-media="${media}"]`).classList.add('active');
renderGallery();
}
// ===== MAIN APP FUNCTIONS =====
function showMainApp() {
document.getElementById('loginModal').style.display = 'none';
document.getElementById('loadingScreen').style.display = 'none';
document.getElementById('mainApp').style.display = 'flex';
loadPhotos();
    // Ensure UI reflects the chosen filter on startup
    setFilter(currentFilter);
    showGallery();
}
function setActiveNavItem(activeId) {
document.querySelectorAll('.nav-item').forEach(item => {
item.classList.remove('active');
});
document.querySelector(`[onclick*="${activeId}"]`).classList.add('active');
}
function showGallery() {
setActiveNavItem('showGallery');
document.getElementById('gallerySection').style.display = 'block';
document.getElementById('profileSection').style.display = 'none';
document.getElementById('infoSection').style.display = 'none';
document.getElementById('sidebar').style.display = 'block';
    // show the sidebar toggle only for gallery
    const menuBtn = document.getElementById('menuBtn');
    if (menuBtn) menuBtn.style.display = '';
renderGallery();
}
function openProfile(e) {
e.preventDefault();
// Tutup sidebar jika terbuka
if (sidebarActive) toggleMenu();
setActiveNavItem('openProfile');
document.getElementById('gallerySection').style.display = 'none';
document.getElementById('profileSection').style.display = 'block';
document.getElementById('infoSection').style.display = 'none';
document.getElementById('sidebar').style.display = 'none';
    // hide the sidebar toggle outside gallery view
    const menuBtn = document.getElementById('menuBtn');
    if (menuBtn) menuBtn.style.display = 'none';
if (currentUser) {
document.getElementById('profileName').textContent = currentUser;
document.getElementById('profileCode').textContent = localStorage.getItem('user_code') || '-';
document.getElementById('profileDownloads').textContent = localStorage.getItem('downloads_' + currentUser) || '0';
}
}
function openInfo(e) {
e.preventDefault();
// Tutup sidebar jika terbuka
if (sidebarActive) toggleMenu();
setActiveNavItem('openInfo');
document.getElementById('gallerySection').style.display = 'none';
document.getElementById('profileSection').style.display = 'none';
document.getElementById('infoSection').style.display = 'block';
document.getElementById('sidebar').style.display = 'none';
    // hide the sidebar toggle outside gallery view
    const menuBtn = document.getElementById('menuBtn');
    if (menuBtn) menuBtn.style.display = 'none';
}
function logout(e) {
e.preventDefault();
if (confirm('Yakin ingin logout?,semua data login kamu bakalan hilang loh!')) {
localStorage.removeItem('logged_in_user');
localStorage.removeItem('user_code');
location.reload();
}
}
// ===== PHOTO LOADING =====
async function loadPhotos() {
    // Show loading message and handle offline scenarios
    if (!navigator.onLine) {
        showPopup('Internet tidak tersedia', false, true, false, true);
        allPhotos = [];
        renderGallery();
        return;
    }
    // Indicate database loading
    showPopup('Memuat database...', false, false, false, false);
    try {
        const resp = await fetch('https://tkj1.pages.dev/DB/photos.json', { cache: 'no-store' });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        if (Array.isArray(data)) allPhotos = data;
        else if (data && Array.isArray(data.photos)) allPhotos = data.photos;
        else allPhotos = [];
        hidePopup();
    } catch (err) {
        console.error('Error loading photos:', err);
        hidePopup();
        showPopup('Memuat database gagal', false, true, false, true);
        allPhotos = [];
    }
    renderGallery();
}
// ===== GALLERY RENDERING =====
// === SETUP OBSERVER (HANYA SEKALI) ===
let imgObserver;
// Flag to prevent accidental selection when context menu is open
let contextMenuOpen = false;
function setupLazyObserver() {
    if (imgObserver) return;
    if ('IntersectionObserver' in window) {
        imgObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    const src = el.dataset.src;
                    if (src) {
                        if (el.tagName === 'VIDEO') {
                            el.src = src;
                            // load metadata first; finalize when enough data available
                            el.load();
                            el.onloadeddata = () => finalizeLoad(el);
                        } else {
                            el.src = src;
                            el.onload = () => finalizeLoad(el);
                            el.onerror = () => finalizeLoad(el); // tetap tampilkan meski error
                        }
                        imgObserver.unobserve(el);
                    }
                }
            });
        }, { rootMargin: '200px' });
    } else {
        // Fallback for older browsers: immediately load media
        imgObserver = {
            observe(el) {
                const src = el.dataset.src;
                if (!src) return;
                if (el.tagName === 'VIDEO') {
                    el.src = src;
                    el.load();
                    el.onloadeddata = () => finalizeLoad(el);
                } else {
                    el.src = src;
                    el.onload = () => finalizeLoad(el);
                    el.onerror = () => finalizeLoad(el);
                }
            },
            unobserve() { /* no-op */ }
        };
    }
}

function finalizeLoad(mediaEl) {
    const item = mediaEl.parentElement;
    if (item) {
        item.classList.remove('skeleton');
        item.classList.add('loaded');
        // ensure media fades in (remove inline hidden opacity)
        try { mediaEl.style.opacity = '1'; } catch (e) { /* ignore */ }
    }
}

function renderGallery(filteredOverride) {
    // Use optimized rendering: accept optional filtered array, otherwise use allPhotos
    let filtered = Array.isArray(filteredOverride) ? filteredOverride : allPhotos.slice();
    // Apply filters
    if (currentFilter === 'group') filtered = filtered.filter(p => p.gender !== 'male' && p.gender !== 'female');
    else if (currentFilter === 'male') filtered = filtered.filter(p => p.gender === 'male');
    else if (currentFilter === 'female') filtered = filtered.filter(p => p.gender === 'female');
    if (currentMediaFilter === 'photo') filtered = filtered.filter(p => p.gender !== 'video' && !/\.(mp4|webm|avi)$/i.test(p.url));
    else if (currentMediaFilter === 'video') filtered = filtered.filter(p => p.gender === 'video' || /\.(mp4|webm|avi)$/i.test(p.url));
    const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();
    if (searchTerm) {
        filtered = filtered.filter(p => (p.name && p.name.toLowerCase().includes(searchTerm)) || (p.date && p.date.includes(searchTerm)));
    }

    const container = document.getElementById('galleryContainer');
    container.innerHTML = '';
    if (!filtered || filtered.length === 0) {
        // optionally show a no-results message (not present in current UI)
        return;
    }

    // Build using document fragment for performance
    const frag = document.createDocumentFragment();

    // If list view requested, render a simple vertical list
    if (currentViewMode === 'list') {
        const listWrap = document.createElement('div');
        listWrap.className = 'photo-list';
        const listFrag = document.createDocumentFragment();
        filtered.forEach(photo => {
            const row = document.createElement('div');
            row.className = 'list-item skeleton';

            const img = document.createElement('img');
            // For list view we want immediate preview (not dark), so set src directly
            img.src = photo.url;
            img.alt = photo.name || '';
            img.style.opacity = '1';
            row.appendChild(img);

            const info = document.createElement('div');
            info.className = 'info';
            info.innerHTML = `<div class="name">${photo.name || 'Tanpa Nama'}</div><div class="date">${photo.date ? formatDateReadable(photo.date) : '-'}</div>`;
            row.appendChild(info);

            const actions = document.createElement('div');
            actions.className = 'actions';
            const btn = document.createElement('button');
            btn.className = 'btn btn-primary';
            btn.title = 'Unduh';
            btn.innerHTML = '<i class="fas fa-ellipsis-v"></i>';
            actions.appendChild(btn);
            row.appendChild(actions);

            // Event handlers
            // Open elegant action menu for this item (Preview, Download, Share, Report)
            btn.addEventListener('click', (ev) => { ev.stopPropagation(); currentPhoto = photo; selectedPhotoForReport = photo; const anchor = ev.target.closest('.list-item'); showContextMenu(ev.clientX, ev.clientY, 'list', anchor); });
            row.addEventListener('click', () => { currentPhoto = photo; openImage(photo); });
            row._photo = photo;
            listFrag.appendChild(row);
        });
        listWrap.appendChild(listFrag);
        container.appendChild(listWrap);

        // Setup observer and observe list images
        setupLazyObserver();
        container.querySelectorAll('.list-item img, .list-item video').forEach(el => imgObserver.observe(el));

        return; // finished rendering list
    }

    // Group by initial letter (like live site)
    const groups = {};
    filtered.forEach(p => {
        const letter = (p.name || '?').charAt(0).toUpperCase();
        (groups[letter] = groups[letter] || []).push(p);
    });
    Object.keys(groups).sort().forEach(letter => {
        const section = document.createElement('div');
        section.className = 'letter-section';
        const header = document.createElement('h2');
        header.className = 'letter-header';
        header.textContent = letter;
        const grid = document.createElement('div');
        grid.className = 'gallery-grid';
        groups[letter].forEach(photo => {
            const item = document.createElement('div');
            item.className = 'gallery-item skeleton';
            item.style.aspectRatio = '1 / 1.2';
            item.setAttribute('data-photo-id', photo.url);

            const isVideo = photo.gender === 'video' || /\.(mp4|webm|avi)$/i.test(photo.url);
            if (isVideo) {
                const vid = document.createElement('video');
                vid.dataset.src = photo.url;
                vid.draggable = false;
                vid.setAttribute('ondragstart', 'return false;');
                vid.preload = 'metadata';
                vid.muted = true;
                vid.playsInline = true;
                vid.style.opacity = '0';
                item.appendChild(vid);
            } else {
                const img = document.createElement('img');
                img.dataset.src = photo.url;
                img.draggable = false;
                img.setAttribute('ondragstart', 'return false;');
                img.alt = photo.name || '';
                img.style.opacity = '0';
                item.appendChild(img);
            }

            const meta = document.createElement('div');
            meta.className = 'gallery-item-meta';
            meta.innerHTML = `<div class="gallery-item-name">${photo.name || 'Tanpa Nama'}</div><div class="gallery-item-date">${photo.date || 'Tanggal tidak tersedia'}</div>`;
            item.appendChild(meta);

            // Keep a lightweight pointer to photo on element
            item._photo = photo;
            grid.appendChild(item);
        });
        section.appendChild(header);
        section.appendChild(grid);
        frag.appendChild(section);
    });
    container.appendChild(frag);

    // Ensure event delegation listeners exist (added once)
    attachGalleryDelegates();
    // Setup observer and observe gallery media
    setupLazyObserver();
    container.querySelectorAll('.gallery-item > img, .gallery-item > video, .list-item img, .list-item video').forEach(el => {
        imgObserver.observe(el);
    });
}

// Set view mode and update sidebar active state
function setViewMode(mode, elem, skipCloseSidebar = false) {
    if (!mode) return;
    currentViewMode = mode;
    // Update active class
    document.querySelectorAll('[data-view]').forEach(it => it.classList.remove('active'));
    if (elem) elem.classList.add('active');
    else {
        const el = document.querySelector(`[data-view="${mode}"]`);
        if (el) el.classList.add('active');
    }
    // Close sidebar if requested
    if (!skipCloseSidebar && sidebarActive) toggleMenu();
    // Ensure gallery is visible and re-render
    showGallery();
    renderGallery();
}


// Attach event delegation for gallery interactions (click + long-press)
let _galleryDelegatesAttached = false;
function attachGalleryDelegates() {
    if (_galleryDelegatesAttached) return;
    _galleryDelegatesAttached = true;
    const container = document.getElementById('galleryContainer');
    if (!container) return;

    let pressTimer = null;
    let startX = 0, startY = 0;
    let isLongPress = false;
    const LONG_PRESS_MS = 800; // responsive long-press duration

    function findPhotoFromTarget(target) {
        const item = target.closest('.gallery-item');
        return item ? item._photo : null;
    }

    container.addEventListener('mousedown', (e) => {
        const photo = findPhotoFromTarget(e.target);
        if (!photo) return;
        isLongPress = false;
        startX = e.clientX; startY = e.clientY;
        const itemEl = e.target.closest('.gallery-item, .list-item');
        pressTimer = setTimeout(() => {
            isLongPress = true;
            selectedPhotoForReport = photo;
            const source = itemEl && itemEl.classList.contains('gallery-item') ? 'grid' : 'list';
            showContextMenu(e.clientX, e.clientY, source, itemEl);
        }, LONG_PRESS_MS);
    });
    container.addEventListener('mouseup', (e) => {
        clearTimeout(pressTimer);
    });
    container.addEventListener('mouseleave', (e) => clearTimeout(pressTimer));
    // Touch support
    container.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        const photo = findPhotoFromTarget(e.target);
        if (!photo) return;
        isLongPress = false;
        startX = touch.clientX; startY = touch.clientY;
        const itemEl = e.target.closest('.gallery-item, .list-item');
        pressTimer = setTimeout(() => {
            isLongPress = true;
            selectedPhotoForReport = photo;
            const source = itemEl && itemEl.classList.contains('gallery-item') ? 'grid' : 'list';
            showContextMenu(touch.clientX, touch.clientY, source, itemEl);
        }, LONG_PRESS_MS);
    }, { passive: true });
    container.addEventListener('touchend', () => clearTimeout(pressTimer));
    container.addEventListener('touchcancel', () => clearTimeout(pressTimer));

    container.addEventListener('click', (e) => {
        // If context menu is open, ignore clicks to avoid accidental selection
        if (contextMenuOpen) {
            contextMenuOpen = false;
            return;
        }
        const photo = findPhotoFromTarget(e.target);
        if (!photo) return;
        // If long press occurred, do not open modal
        if (isLongPress) {
            isLongPress = false;
            return;
        }
        openImage(photo);
    });
}
// Fungsi untuk menampilkan context menu dan menambahkan overlay
function showContextMenu(x, y, source, anchorEl) {
    const menu = document.getElementById('customContextMenu');
    if (!menu) return;
    // Full action set for both grid and list
    menu.innerHTML = `
        <div class="context-menu-item" onclick="previewContextItem()"><i class="fas fa-eye"></i> Pratinjau</div>
        <div class="context-menu-item" onclick="downloadContextItem()"><i class="fas fa-download"></i> Unduh</div>
        <div class="context-menu-item" onclick="shareContextItem()"><i class="fas fa-share-alt"></i> Bagikan</div>
        <div class="context-menu-item" onclick="reportImage()"><i class="fas fa-exclamation-triangle"></i> Laporkan Foto</div>
    `;

    // Ensure the menu actions operate on the correct photo (set current selection)
    let resolvedPhoto = null;
    if (selectedPhotoForReport) resolvedPhoto = selectedPhotoForReport;
    else if (anchorEl && anchorEl._photo) resolvedPhoto = anchorEl._photo;
    else if (anchorEl) {
        // Try to infer from image src if the element lacks _photo
        const img = anchorEl.querySelector('img');
        if (img) resolvedPhoto = { url: img.src || img.dataset.src, name: img.alt || '' };
    }
    if (resolvedPhoto) {
        currentPhoto = resolvedPhoto;
        selectedPhotoForReport = resolvedPhoto;
    }

    // Positioning: measure first, then compute placement anchored to element when possible
    menu.style.visibility = 'hidden';
    menu.classList.add('show');
    const rectMenu = menu.getBoundingClientRect();
    let left = 8, top = 8;
    if (anchorEl) {
        const a = anchorEl.getBoundingClientRect();
        // default: centered horizontally over anchor, below it
        left = a.left + (a.width - rectMenu.width) / 2;
        top = a.bottom + 8;
        // Clamp horizontally
        if (left + rectMenu.width > window.innerWidth - 8) left = window.innerWidth - rectMenu.width - 8;
        if (left < 8) left = 8;
        // If it doesn't fit vertically below, place above
        if (top + rectMenu.height > window.innerHeight - 8) top = a.top - rectMenu.height - 8;
        if (top < 8) top = 8;
    } else {
        // fallback to pointer coordinates
        left = x;
        top = y;
        if (left + rectMenu.width > window.innerWidth - 8) left = x - rectMenu.width;
        if (left < 8) left = 8;
        if (top + rectMenu.height > window.innerHeight - 8) top = y - rectMenu.height;
        if (top < 8) top = 8;
    }
    menu.style.left = `${left}px`;
    menu.style.top = `${top}px`;
    menu.style.visibility = '';

    // Block background clicks to avoid accidental selection
    contextMenuOpen = true;
    document.body.classList.add('context-active');
    document.addEventListener('click', closeContextMenuOnClick, { once: true });
}
// Fungsi untuk menutup context menu dan menghapus overlay
function closeContextMenu() {
const menu = document.getElementById('customContextMenu');
menu.classList.remove('show');
// Hapus class dari body untuk menghilangkan overlay
document.body.classList.remove('context-active');
// Hapus listener jika terjadi error
document.removeEventListener('click', closeContextMenuOnClick);
    // allow clicks again
    contextMenuOpen = false;
}
function closeContextMenuOnClick(e) {
const menu = document.getElementById('customContextMenu');
if (!menu.contains(e.target)) {
closeContextMenu();
}
}

// Close context menu on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && contextMenuOpen) {
        closeContextMenu();
    }
});

// === RIGHT-CLICK (DESKTOP) ===
// Show custom context menu on right-click for gallery/list items and disable browser menu
document.addEventListener('contextmenu', (e) => {
    // Always prevent native menu
    e.preventDefault();
    // Only show custom menu on desktop
    try {
        const desktop = (window.innerWidth > 768 && !('ontouchstart' in window));
        if (!desktop) return false;
        const targetItem = e.target.closest('.gallery-item, .list-item');
        if (targetItem) {
            const source = targetItem.classList.contains('gallery-item') ? 'grid' : 'list';
            // Use pointer position and anchor element so direction is consistent
            showContextMenu(e.clientX, e.clientY, source, targetItem);
        } else {
            // clicked outside items -> close any open custom menu
            if (contextMenuOpen) closeContextMenu();
        }
    } catch (err) {
        // swallow errors to avoid breaking right-click behavior
        console.warn('contextmenu handler error', err);
    }
    return false;
}, false);
// Debounced search to avoid re-render on every keystroke
let _searchTimer = null;
function performSearch() {
    clearTimeout(_searchTimer);
    _searchTimer = setTimeout(() => {
        renderGallery();
    }, 180);
}

// Helper: return readable date (DD-MM-YYYY) from YYYY-MM-DD
function formatDateReadable(dateStr) {
    if (!dateStr) return '';
    const parts = dateStr.split('-');
    if (parts.length < 3) return dateStr;
    return `${parts[2]}-${parts[1]}-${parts[0]}`;
}
// ===== IMAGE MODAL =====
function openImage(photo) {
currentPhoto = photo;
const modal = document.getElementById('imageModal');
const image = document.getElementById('modalImage');
const video = document.getElementById('modalVideo');
const isVideo = photo.gender === 'video' || /\.(mp4|webm|avi)$/i.test(photo.url);
if (isVideo) {
image.style.display = 'none';
video.style.display = 'block';
video.src = photo.url;
video.load();
} else {
image.style.display = 'block';
video.style.display = 'none';
image.src = photo.url;
}
    // Show full name and readable date
    document.getElementById('imageName').textContent = photo.name || 'Foto Tanpa Nama';
    document.getElementById('imageDate').textContent = photo.date ? formatDateReadable(photo.date) : 'Tanggal tidak tersedia';
modal.classList.add('active');
}
function closeModal() {
document.getElementById('imageModal').classList.remove('active');
const video = document.getElementById('modalVideo');
if (video) video.pause();
}
function downloadImage() {
    // Robust download flow with simple-mode fallback for constrained WebViews
    if (!currentPhoto) return;
    const photo = currentPhoto;
    const btn = document.getElementById('downloadBtn');
    const originalText = btn ? btn.innerHTML : '';
    if (btn) { btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sedang Mengunduh...'; btn.disabled = true; }

    // Build safe filename: name_date.ext
    const url = (photo.url || '');
    const ext = (url.split('.').pop() || '').split(/[#?]/)[0] || 'jpg';
    const safeName = (photo.name || 'tkjone').replace(/[^\w\s\-_.]/g, '').trim().replace(/\s+/g, '_') || 'tkjone';
    const datePart = photo.date ? ('_' + photo.date) : '';
    const filename = `${safeName}${datePart}.${ext}`;

    // Detect whether to use a simple download method (anchor or open URL)
    const shouldUseSimpleDownload = () => {
        // Allow forcing via localStorage flag for testing
        if (localStorage.getItem('force_simple_download') === '1') return true;
        // Cordova without file plugin or running in common Android WebView contexts -> simple
        if (window.cordova && !window.cordova.file) return true;
        if (window.Capacitor && navigator.userAgent.toLowerCase().includes('android')) return true;
        // Detect Android WebView (contains ; wv) or older Android WebView strings
        if (/;\s*wv\)|android.*\s+wv/i.test(navigator.userAgent)) return true;
        // Otherwise try advanced method
        return false;
    };

    const simpleDownload = () => {
        try {
            // Preferred simple approach: anchor with download attribute
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            const count = (parseInt(localStorage.getItem('downloads_' + currentUser)) || 0) + 1;
            localStorage.setItem('downloads_' + currentUser, count.toString());
            return Promise.resolve();
        } catch (err) {
            // Fallback to opening in system browser or new tab
            if (window.cordova && window.cordova.InAppBrowser) {
                window.open(url, '_system');
            } else {
                window.open(url, '_blank', 'noopener');
            }
            return Promise.resolve();
        }
    };

    (async () => {
        try {
            if (shouldUseSimpleDownload()) {
                await simpleDownload();
                return;
            }

            const resp = await fetch(url, { mode: 'cors' });
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const blob = await resp.blob();
            // Try to trigger download via blob
            const blobUrl = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(blobUrl);
            const count = (parseInt(localStorage.getItem('downloads_' + currentUser)) || 0) + 1;
            localStorage.setItem('downloads_' + currentUser, count.toString());
        } catch (err) {
            console.error('Download failed, trying simple fallback:', err);
            // Fallback to simple download method
            await simpleDownload();
        } finally {
            if (btn) setTimeout(() => { btn.innerHTML = originalText; btn.disabled = false; }, 800);
        }
    })();
}
// ===== REPORT FUNCTION =====
function reportImage() {
closeContextMenu(); // Tutup menu dan hapus overlay segera
if (!selectedPhotoForReport || !currentUser) return;
const userCode = localStorage.getItem('user_code') || 'Tidak Tersedia';
const photoName = selectedPhotoForReport.name || 'Nama Tidak Tersedia';
const message =
`Nama : ${currentUser}
Kode user : (${userCode})
Nama Foto : "${photoName}"
Silahkan ketik masalah kamu:`;
const encodedMessage = encodeURIComponent(message);
const whatsappUrl = `https://wa.me/6285165721384?text=${encodedMessage}`;
window.open(whatsappUrl, '_blank');
}
function previewContextItem() {
    closeContextMenu();
    if (!currentPhoto) return;
    openImage(currentPhoto);
}
function downloadContextItem() {
    closeContextMenu();
    if (!currentPhoto) return;
    // ensure download uses currentPhoto
    downloadImage();
}
function shareContextItem() {
    closeContextMenu();
    if (!currentPhoto) return;
    const p = currentPhoto;
    if (navigator.share) {
        navigator.share({ title: p.name || '', text: p.name || '', url: p.url }).catch(() => {});
    } else {
        // Fallback: copy URL to clipboard
        if (navigator.clipboard) {
            navigator.clipboard.writeText(p.url).then(() => showPopup('URL disalin ke clipboard', false, false, false, true));
        } else {
            showPopup('Fitur bagikan tidak tersedia', false, true, false, true);
        }
    }
}
// Preview modal handlers
function openPreviewModal() {
    const modal = document.getElementById('previewModal');
    const list = document.getElementById('previewList');
    if (!modal || !list) return;
    // Build list from current filtered photos
    const items = getFilteredPhotos();
    list.innerHTML = '';
        if (!items || items.length === 0) {
            list.innerHTML = '<p style="color:var(--text-secondary);">Tidak ada foto untuk ditampilkan.</p>';
        } else {
            const frag = document.createDocumentFragment();
            items.forEach(p => {
                const row = document.createElement('div');
                row.className = 'preview-list-row';
                // Thumbnail
                const thumb = document.createElement('img');
                thumb.src = p.url;
                thumb.alt = p.name || '';
                thumb.className = 'preview-thumb';
                // Info
                const info = document.createElement('div');
                info.className = 'preview-info';
                info.innerHTML = `<div class="preview-name">${p.name || 'Tanpa Nama'}</div><div class="preview-date">${p.date ? formatDateReadable(p.date) : '-'}</div>`;
                // Actions
                const right = document.createElement('div');
                right.className = 'preview-actions';
                const dl = document.createElement('button');
                dl.className = 'btn btn-primary';
                dl.style.padding = '6px 10px';
                dl.innerHTML = '<i class="fas fa-download"></i>';
                dl.onclick = (ev) => { ev.stopPropagation(); currentPhoto = p; downloadImage(); };
                right.appendChild(dl);
                // Clicking row opens the photo modal
                row.onclick = () => { currentPhoto = p; closePreviewModal(); openImage(p); };
                row.appendChild(thumb);
                row.appendChild(info);
                row.appendChild(right);
                frag.appendChild(row);
            });
            list.appendChild(frag);
        }
    modal.style.display = 'flex';
    // Prevent background scrolling while modal is open
    document.body.style.overflow = 'hidden';
    // Focus the list for accessibility
    list.focus && list.focus();
}
function closePreviewModal() {
    const modal = document.getElementById('previewModal');
    if (!modal) return;
    modal.style.display = 'none';
    // Restore body scroll
    document.body.style.overflow = '';
}

// Called by sidebar item to open preview and close the sidebar
function openPreviewFromSidebar(elem) {
    // Close sidebar if open
    if (sidebarActive) toggleMenu();
    // Update active state in sidebar
    document.querySelectorAll('#sidebar .sidebar-menu-item').forEach(it => it.classList.remove('active'));
    if (elem) elem.classList.add('active');
    // Open preview modal
    // If user intended list view instead of modal, switch view mode
    if (elem && elem.getAttribute('data-view') === 'list') {
        setViewMode('list', elem);
    } else {
        openPreviewModal();
    }
}

// Build filtered photo list used by preview and other features
function getFilteredPhotos() {
    let filtered = allPhotos.slice();
    if (currentFilter === 'group') filtered = filtered.filter(p => p.gender !== 'male' && p.gender !== 'female');
    else if (currentFilter === 'male') filtered = filtered.filter(p => p.gender === 'male');
    else if (currentFilter === 'female') filtered = filtered.filter(p => p.gender === 'female');
    if (currentMediaFilter === 'photo') filtered = filtered.filter(p => p.gender !== 'video' && !/\.(mp4|webm|avi)$/i.test(p.url));
    else if (currentMediaFilter === 'video') filtered = filtered.filter(p => p.gender === 'video' || /\.(mp4|webm|avi)$/i.test(p.url));
    const searchTerm = (document.getElementById('searchInput')?.value || '').toLowerCase();
    if (searchTerm) filtered = filtered.filter(p => (p.name && p.name.toLowerCase().includes(searchTerm)) || (p.date && p.date.includes(searchTerm)));
    return filtered;
}
// ===== SECURITY =====
function acceptSecurity() {
document.getElementById('securityNotice').style.display = 'none';
localStorage.setItem('security_accepted', 'true');
}
window.addEventListener('DOMContentLoaded', () => {
if (!localStorage.getItem('security_accepted')) {
document.getElementById('securityNotice').style.display = 'block';
} else {
document.getElementById('securityNotice').style.display = 'none';
}
});
// Setup long-press behavior for "Buka Tabel" button (toggle mode to request code)
let openMembersBtn_pressTimer = null;
let openMembersBtn_isLongPress = false;
let openMembersBtn_modeGetCode = false;
function setupOpenMembersBtnLongPress() {
    const btn = document.getElementById('openMembersBtn');
    if (!btn) return;
    btn.addEventListener('mousedown', (e) => {
        openMembersBtn_isLongPress = false;
        openMembersBtn_pressTimer = setTimeout(() => {
            openMembersBtn_isLongPress = true;
            openMembersBtn_modeGetCode = !openMembersBtn_modeGetCode;
            updateOpenMembersBtnDisplay();
        }, 800);
    });
    btn.addEventListener('mouseup', (e) => {
        if (openMembersBtn_pressTimer) { clearTimeout(openMembersBtn_pressTimer); openMembersBtn_pressTimer = null; }
        if (!openMembersBtn_isLongPress) {
            if (openMembersBtn_modeGetCode) {
                // open page to request code
                window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
            } else {
                // Fallback: open members table page
                window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
            }
        }
    });
    btn.addEventListener('mouseleave', () => { if (openMembersBtn_pressTimer) { clearTimeout(openMembersBtn_pressTimer); openMembersBtn_pressTimer = null; } openMembersBtn_isLongPress = false; });
    // Touch
    btn.addEventListener('touchstart', (e) => {
        openMembersBtn_isLongPress = false;
        openMembersBtn_pressTimer = setTimeout(() => {
            openMembersBtn_isLongPress = true;
            openMembersBtn_modeGetCode = !openMembersBtn_modeGetCode;
            updateOpenMembersBtnDisplay();
        }, 800);
    }, { passive: true });
    btn.addEventListener('touchend', (e) => {
        if (openMembersBtn_pressTimer) { clearTimeout(openMembersBtn_pressTimer); openMembersBtn_pressTimer = null; }
        if (!openMembersBtn_isLongPress) {
            if (openMembersBtn_modeGetCode) window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
            else window.open('https://code-dt9.pages.dev/', '_blank', 'noopener,noreferrer');
        }
    });
}
function updateOpenMembersBtnDisplay() {
    const btn = document.getElementById('openMembersBtn');
    if (!btn) return;
    if (openMembersBtn_modeGetCode) {
        btn.textContent = 'Minta Kode Alternatif';
        btn.style.background = '#ff0080';
        btn.style.color = 'white';
    } else {
        btn.innerHTML = '<i class="fas fa-user"></i> Minta kode';
        btn.style.background = '';
        btn.style.color = '';
    }
}
document.addEventListener('DOMContentLoaded', setupOpenMembersBtnLongPress);
// Prevent default events
document.addEventListener('dragstart', e => e.preventDefault());
document.addEventListener('drop', e => e.preventDefault());
document.addEventListener('copy', e => {
if (!e.target.closest('#accessCode')) e.preventDefault();
});
document.addEventListener('paste', e => {
if (!e.target.closest('#accessCode')) e.preventDefault();
});
</script>
<!-- Component scripts (copies) -->
<script src="components/sidebar/sidebar.js"></script>
<script src="components/bottombar/bottombar.js"></script>
<script src="components/login/login.js"></script>
</body>
</html>